<html>
   <head>
      <html>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <STYLE TYPE="text/css">
      <!--
         @page { size: 21cm 29.7cm; margin: 2cm }
         p { margin-left: 0.50cm }
         h1 { color:#000000; text-align:center; }
         h2 { color:#800000; text-align:center;}
         h3 { color:#ff8800;}
         h4 { color:#008800;}
         h5 { color:#008888;}
         tt { color:#000000;}
         div.emTAB {margin-left:3%;}
         pre.emTEXT {
            white-space: pre-wrap;
         }
         .preinf {
            text-align:justify;
            margin-left:50%;
            font-size:0.75em;
            text-indent:1em;
         }
         .postcont {
            text-align:center;
            margin-left:75%;
            width:25%;
            font-size:0.75em;
         }
         .bodyED {
            text-align:justify;
            margin-left:auto;
            margin-right:auto;
            width:55%;
            background-color:#ffffff;
            padding:0.5em 2em;
         }
         .centerED {
            margin-left:auto;
            margin-right:auto;
            padding:0.1em 2em;
            width:50%;
         }
         p.emCODE, pre.emCODE {
            margin-left:1em;
         }
         .emCODE {
            color:000000;
            font-family:monospace;
         }
         .emREMARK {
            color:#888888;
            font-weight:normal;
            font-style:italic;
         }
         .emHREF{text-decoration:none; color:#888888;}
         .emTOOL{text-decoration:none; color:#006688;}
         .emFUNC, .emOPRT, .emFOLD, .emTEXT, .emVAR, .emNUM, .emATTRIB, .emCOMMENT, .emMARKER {font-weight:bold; font-family:monospace;}
         .emFUNC {color:#ff8800;} /*цвет выделения функций*/
         .emOPRT {color:#008899;} /*цвет выделения операторов*/
         .emFOLD {color:#000000;background:#F6F6BC;} /*цвет выделения папок*/
         .emTEXT {color:#008800;} /*цвет выделения текстовых значений*/
         .emINCL {color:#006600;} /*цвет выделения вложенных текстовых значений*/
         .emVAR {color:#aa0000;}
         .emMARKER {color:#ff1111;}
         .emNUM {color:#880088; font-size:1.15em;}
         .emATTRIB {color:#000088;}
         .emCOMMENT {color:#888888;}
      -->
      </STYLE>
   </head>
<body bgcolor="#F0E68C">
   <h1>easy.dialog.qsp v 2.0</h1>
   <div class="bodyED">
      <a name="easy_dialog_edit"></a>
      <h2>Написание диалогов</h2>
      <a name="easy_dialog_easy_dialog"></a>
      <h3>Простые диалоги</h3>

      <p>Чтобы использовать модуль, нужно знать, как написать диалог, чтобы модуль вас понял.</p>
      <p>Диалоги пишутся предельно просто и не требуют специальных знаний, кроме тех, которые Вы получите сейчас.</p>
      <p>Диалог - это разговор, как правило, двух персонажей. В игре один персонаж - это герой, которым управляет игрок, другой персонаж - неиграбельный, т.е. игрок условно не может им управлять. Персонаж игрока мы будем называть героем, а персонаж, с которым герой вступает в диалог, просто персонажем, актёром, или неписью (от англ. NPC - non-playable character).</p>
      <p>Фразы, доступные игроку (и соответственно герою), должны выводиться в виде списка действий, доступных для выбора и выполнения. А фразы актёра должны выводиться непосредственно на экран автоматически. Собственно это все различия между одним типом фраз и другим.</p>
      <p>Итак, у нас есть фразы NPC, которые выводятся автоматически, и фразы героя, которые появляются в виде действий и не используются в диалоге, пока игрок не выберет одну из них. Оба типа фраз помещаются между специальными метками. Я называю их тегами.</p>
      <p><span class="emTEXT">{: <span class="emINCL">Фраза, которую будет произносить неиграбельный персонаж</span> :}</span>   -   фигурная скобка, двоеточие, потом идёт реплика персонажа, потом двоеточие и снова фигурная скобка. "<span class="emTEXT">{:</span>" - открывающий тег. "<span class="emTEXT">:}</span>" - закрывающий тег. Всё, что произносит актёр, помещаем между такими тегами. Каждая отдельная фраза должна помещаться между тегами. Например:
      <pre class="emTEXT">
         {: Сегодня прекрасная погода. :}
         {: Не думал я, что будет дождь! :}
         {: На город набегают тучи, осенний сплин кого-то мучит... :}
      </pre>
      <p><span class="emTEXT">[: <span class="emINCL">Фраза, которая превратится в действие, а когда игрок выберет действие, станет репликой в диалоге.</span> :]</span>   - квадратная скобка, двоеточие, потом идёт реплика героя, снова двоеточие, квадратная скобка. "<span class="emTEXT">[:</span>" - открывающий тег, "<span class="emTEXT">:]</span>" - закрывающий тег. Всё, что может сказать герой, помещаем между такими тегами. Опять же, каждая отдельная фраза - в отдельных тегах. И каждая такая фраза будет выведена одним действием.</p>
      <p>Фразы героя и актёра можно располагать одна в другой, или несколько в одной. Мало того, можно располагать фразы одного типа друг в друге.</p>
      <p>Зачем это нужно? А вот зачем: диалог собирается и распознаётся по принципу вопрос-ответ. Допустим, реплика актёра - это вопрос, а реплика героя должна быть ответом на вопрос. Но игроку можно предложить несколько вариантов ответов на вопрос. Чтобы написать такой простой диалог: вопрос и несколько ответов, - делаем так:</p>
      <p>Первым делом пишем вопрос. Например, непись должна спросить героя "Как тебя зовут?". Пишем:</p>
      <pre class="emTEXT">
         {: Как тебя зовут? :}
      </pre>
      <p>А теперь ответы на вопрос "вкладываем" в вопрос:
      <pre class="emTEXT">
         {: Как тебя зовут?
            [:Вася:]
            [:Петя:]
            [:Не твоё дело!:]
            [:Я забыл...:]
         :}
      </pre>
      <p>На экран выведется реплика актёра "Как тебя зовут?" и четыре действия. При щелчке на любом из действий, герой будет произносить фразу, написанную в этих репликах. Например, если игрок выберет действие "Я забыл...", на экран выведется фраза героя "Я забыл...".</p>

      <p>Как сделать так, чтобы по щелчку на действии произносил фразу не только герой, но и актёр? Всё тем же способом. "Вложить" реплику актёра в реплику героя. Разовьём предыдущий пример:
      <pre class="emTEXT">
         {: Как тебя зовут?
            [:Вася:]
            [:Петя:]
            [:Не твоё дело!:]
            [:А тебя как?
               {:Меня Васькой Пупкиным кличут:}
            :]
         :}
      </pre>
      <P>Таким образом, вкладывая реплики друг в друга, вы можете создавать большие ветвистые диалоги. Для примера, вот небольшой ветвистый диалог, на котором отрабатывались первые сборки модуля:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
               Меня зовут Вася.
               {:Вас зовут Вася?
                  [:Да, меня зовут Вася.
                     {:да ну нафиг:}
                     [:
                     нет. чистая правда
                     :]
                  :]
                  [:Нет, никто меня так не зовёт:]
               :}
               {:
                  Это правда, что вас зовут Васей?
                  [:Правда
                  :]
                  [:Неправда:]
               :}
            :]
            [:
               Меня зовут Петя.
               {:
                  Вас зовут Петя?
                  [:Да{:Как это удобно!:}:]
                  [:
                     Нет
                     {:Вас зовут не Петя? Как неудобно!:}
                  :]
               :}
               {:
                  Это правда, что вас зовут Петей?
                  [:Правда:]
                  [:Неправда:]
               :}
               {:Неужели в самом деле Петей Вас зовут?
                  [:В самом деле:]
                  [:Нет, не в самом:]
               :}
            :]
         :}
      </pre>
      <P>Обратите внимание на то, как записаны фразы, которые должны выводиться на экран в диалоге. Перед ними есть пустые строки, символы пробелов и табуляций. Модуль сам очистит фразы от мусора и уберёт пустые строки перед фразой и после неё, а так же пробельные символы перед каждой строкой и после неё. То есть даже если вы вставите фразу между тегами вот так:
      <pre class="emTEXT">
         {:







                           Как вас зовут?






         :}
      </pre>
      <P>То на экран всё равно будет выведено: "Как вас зовут?" без пробелов перед репликой и пустых строк.</P>

      <h3>Настройки диалога</h3>
      <h4>Форматирование реплик</h4>

      <p>по умолчанию, все реплики персонажей выводятся чёрным цветом, все реплики героя серым цветом с курсивом. по умолчанию, перед репликами не ставятся имена, но ставится знак тире. Всё это можно изменить и настроить непосредственно в самом тексте диалога.</p>

      <p>Настройки можно вынести за реплики, тогда эти настройки будут считаться настройками по умолчанию. Например:
      <pre class="emTEXT">
         npc="
         name:Бабуся:name
         "
         hero="name:Солдат Котёнкин:name"

         {:Добрый вечер, милок.
            [:
               Здравствуйте, бабуся!
            :]
            [:
               Девушка, мы разве знакомы?
            :]
         :}
      </pre>
      <P>Настройки доступны самые разнообразные.</P>
      <p><span class="emTEXT">npc="&nbsp;"</span> - настройки отображения фраз неписи в окне основного описания.
      <br><span class="emTEXT">hero="&nbsp;"</span> - настройки отображения фраз героя в окне основного описания.
      <br><a name="backprim1"></a>Настройки, вкладываемые в <span class="emTEXT">npc="&nbsp;"</span> и <span class="emTEXT">hero="&nbsp;"</span> <a href="#prim1" style="text-decoration:none; font-size:12px;" title="Примечание"><sup>[1]</sup></a>:
      <div class="emTAB">
         <span class="emOPRT">name:&nbsp;:name</span> - имя. Если между двоеточиями нет символов, не отображается.
         <br><span class="emOPRT">ncolor:</span> - цвет выводимого имени в шестнадцатеричном формате. Если не указан, или указан ошибочно, выводится чёрным (для неписей) или серым (для героя).
         <br><span class="emOPRT">nattrib:</span> - аттрибуты выводимого имени, указываются подряд без пробелов:
         <div class="emTAB">
            <span class="emATTRIB">-b</span> - жирный
            <br><span class="emATTRIB">-i</span> - курсив
            <br><span class="emATTRIB">-n</span> - нормальный. Сбрасывает значение прочих атрибутов.
            <br>по умолчанию, для героя и для неписи выставлен жирный атрибут, для героя - курсив. Аттрибуты считываются в обратном порядке, начиная с последнего, таким образом происходит и применение. Допустим, мы не хотим, чтобы имя героя отображалось курсивом, но продолжало отображаться жирным шрифтом. Пишем "<span class="emTEXT">nattrib:-b-n</span>". Сначала шрифт вернётся к нормальному виду, потом будет применена жирность. Если указать "<span class="emTEXT">nattrib:-n-b</span>", то сначала будет применена жирность, а потом шрифт вернётся к нормальному виду.
         </div>
      </div>
      <div class="emTAB">
         <span class="emOPRT">fcolor:</span> - цвет выводимой фразы в шестнадцатеричном формате. Если не указан, или указан ошибочно, выводится чёрным (для неписей) или серым (для героя).
         <br><span class="emOPRT">fattrib:</span> - аттрибуты выводимой фразы (см. список выше). Если не указаны, для фраз героя применяется курсив.
         <br><span class="emOPRT">tire:</span> - вид тире. Можно указать любые непробельные символы, и они будут выводиться перед каждой фразой героя или неписи. Чтобы ничего не выводилось, указывается слово "nope". Чтобы выводились символы пробела, используйте <span class="emTEXT">&amp;nbsp;</span> или поместите тег в круглые скобки "<span class="emTEXT">(tire: )</span>".
      </div><a name="replic_sets"></a>
      <p><span class="emTEXT">replics="&nbsp;"</span> - настройки <a href="#replic_sets_a" title="подробнее..." class="emHREF">порядка вывода реплик</a>:
      <div class="emTAB">
         <span class="emOPRT">repeat:</span> - количество повторов вывода реплик неписи:
         <div class="emTAB">
            <span class="emATTRIB">one</span> - выводится одна реплика. Например, выбранная случайно.
            <br><span class="emATTRIB">once</span> - реплики неписи, кроме одиночных, выводятся единожды. Если реплики исчерпаны, выводится последняя.
            <br><span class="emATTRIB">cicle</span> - реплики выводятся по кругу, т.е. имеют свойство повторяться. по умолчанию.
         </div>
         <span class="emOPRT">shuffle:</span> - порядок вывода реплик.
         <div class="emTAB">
            <span class="emATTRIB">random</span> - случайный порядок
            <br><span class="emATTRIB">straight</span> - прямой порядок т.е. от первой к последней. по умолчанию.
            <br>Счёт порядка вывода реплик и количества повторов ведётся только в течении диалога. Как только диалог будет закрыт, счёт обнуляется. Для сохранения счёта реплик, нужно использовать другие способы.
         </div>
      </div>
      </p>
      <p>В записи настроек так же не играет роль количество пробельных символов и переводов строк. Единственное что, между настройками должен находиться хотя бы один пробел, символ табуляции, или символ перевода строки. Примеры настроек:</p>
      <pre class="emTEXT">
         npc="
            name:Бабуся:name
            ncolor:ff8800
            fcolor:886600
            fattrib:-i
            tire:nope
            "
         hero="name:Солдат Котёнкин:name ncolor:000000 fcolor:880088 nattrib:-b-n"
         replics="repeat:one
         shuffle:random"
      </pre>
      <p>Непосредственно в тексте реплик можно использовать любые html-теги, поддерживаемые плеером, и таким образом дополнительно форматировать текст. Например, вы можете выделить одно слово в реплике другим цветом:
      <pre class="emTEXT">
         {:Добрый вечер, милок.
            [:
               Здравствуйте, бабуся!
            :]
            [:
               Девушка, мы разве &lt;font color=#008800&gt;знакомы&lt;/font&gt;?
            :]
         :}
      </pre>
      <p>Перед выводом на экран любая реплика облекается в точно такие же html-теги в соответствии с настройками. Например, Вы настроили цвет для фразы:
      <pre class="emTEXT">
         npc="
            name:Бабуся:name
            fcolor:886600
         "
         {:Добрый вечер, милок.
            [:
               Здравствуйте, бабуся!
            :]
            [:
               Девушка, мы разве &lt;font color=#008800&gt;знакомы&lt;/font&gt;?
            :]
         :}
      </pre>
      <P>Перед выводом на экран, будет сформирована строка:</P>

      <p class="emCODE">&lt;font color=#000000&gt;&lt;b&gt;Бабуся:&lt;/b&gt;&lt;/font&gt;&lt;font color=#886600&gt; — Добрый вечер, милок.&lt;/font&gt;</p>

      <p>На экране это будет выглядеть так:</p>

      <p><font color=#000000><b>Бабуся:</b></font><font color=#886600> — Добрый вечер, милок.</font></p>

      <p>Модуль автоматически включает распознавание html-тегов в плеере, при обращении к локации <span class="emTEXT">"dialog.int"</span>.</p>

      <p>Когда игрок выберет действие "Девушка, мы разве <font color=#008800>знакомы</font>?", перед выводом на экран будет сформирована надпись:</p>

      <p class="emCODE">&lt;font color=#888888&gt;&lt;i&gt; — Девушка, мы разве &lt;font color=#008800&gt;знакомы&lt;/font&gt;?&lt;/i&gt;&lt;/font&gt;
      </p>

      <p>На экране это будет выглядеть так:</p>

      <p><font color=#888888><i> — Девушка, мы разве <font color=#008800>знакомы</font>?</i></font></p>

      <p>То есть будет сохранено автоматическое форматирование и форматирование, которое вы пропишете прямо внутри фразы. Это очень удобно, если нужно форматировать только одну реплику, предложение в реплике, или слово. Html-теги можно использовать и при указании имени, тогда имя будет отличаться от основного цвета.</p>

      <h4>Наследование настроек</h4>

      <P>Указывать настройки можно не только для всего диалога вцелом, но и для отдельных реплик и даже для целых веток. Возьмём наш старый пример и немного его модифицируем:
      <pre class="emTEXT">
         npc="
         name:Ведущий:name
         ncolor:008888
         fcolor:008888
         "
         hero="
         name:Вася Пупкин:name
         "

         {:
            Как вас зовут?
            [:

            hero="ncolor:008800"
               Меня зовут Вася.
               {:Вас зовут Вася?
                  [:
                  npc="fcolor:880000"
                  Да, меня зовут Вася.
                     {:да ну нафиг:}
                     [:
                     нет. чистая правда
                     :]
                  :]
                  [:Нет, никто меня так не зовёт:]
               :}
               {:
                  Это правда, что вас зовут Васей?
                  [:Правда
                  :]
                  [:Неправда:]
               :}
            :]
            [:
            hero="ncolor:ff0000"
               Меня зовут Петя.
               {:
                  Вас зовут Петя?
                  [:Да{:Как это удобно!:}:]
                  [:
                     Нет
                     {:Вас зовут не Петя? Как неудобно!:}
                  :]
               :}
               {:
                  Это правда, что вас зовут Петей?
                  [:Правда:]
                  [:Неправда:]
               :}
               {:Неужели в самом деле Петей Вас зовут?
                  [:В самом деле:]
                  [:Нет, не в самом:]
               :}
            :]
         :}
      </pre>
      <p>До начала диалога мы прописали настройки, которые будут считаться настройками по умолчанию. Первым делом на экран будет выведена фраза "Как вас зовут?" с настройками для npc, которые указаны для всего диалога. Для всего диалога указано так же и имя героя, но не указан ни цвет, ни аттрибуты жирности/наклона, поэтому будут применяться настройки по умолчанию. То есть цвет имени героя будет серым. Однако, как только игрок выберет одно из выпавших действий:</p>

      <div class="emTAB">Меня зовут Вася</div>

      <p>или</p>

      <div class="emTAB">Меня зовут Петя</div>

      <p>будут применены настройки, вложенные в это действие. Эти настройки подменят собой настройки, указанные для всего диалога, но лишь те из них, которые указаны явно. Так, если игрок выберет действие "Меня зовут Вася", имя героя для текущей и всех вложенных реплик будет зелёным. Все остальные настройки останутся прежними. Смотрим дальше. После выбора действия "Меня зовут Вася", актёр "переспросит": "Вас зовут Вася?", фраза эта появится на экране всё с теми же общими настройками для всего диалога. Однако вслед за ней на экране появятся два действия:</p>

      <div class="emTAB">Да, меня зовут Вася.</div><p> и </p><div class="emTAB">Нет, никто меня так не зовёт</div>

      <p>При выборе первого, настройка цвета для вывода фраз неписи изменится, и следующая фраза "да ну нафиг" появится на экране, раскрашенная красным цветом. Таким образом, как уже было сказано, для ветки реплик, или реплики, изменяется только та настройка, которая была явно указана. Не указанные настройки достаются в наследство от старшей реплики (т.е. той, в которую мы вложили текущую).</p>

      <h4>Сброс настроек</h4>

      <p>Для сброса настроек в значение, предопределённое для всего диалога (значения по умолчанию), используется ключевое слово default.</p>

      <p><span class="emTEXT">npc="default"</span>   - сбрасывает все настройки реплик неписи в значения по умолчанию (дефолтные значения),
      <br><span class="emTEXT">hero="default"</span>   - сбрасывает все настройки реплик героя в дефолтные значения,
      <br><span class="emTEXT">replics="default"</span> - сбрасывает все настройки порядка вывода реплик в дефолтные значения.</p>

      <p>Можно сбрасывать так же и отдельную настройку, указав слово default после двоеточия. Например, сбросить цвет фраз:</p>

      <p><span class="emTEXT">fcolor:default</span>
      <a name="replic_sets_a"></a>

      <h4>Порядок вывода реплик</h4>

      <p><a href="#replic_sets" class="emHREF">Выше</a> уже были обозначены основные настройки порядка вывода реплик. Рассмотрим подробнее их поведение на примере последнего диалога, а точнее вот этой его части:
      <pre class="emTEXT">
        [:
        hero="ncolor:ff0000"
           Меня зовут Петя.
           <span style="color:#880000;">{:
              Вас зовут Петя?
              [:Да{:Как это удобно!:}:]
              [:
                 Нет
                 {:Вас зовут не Петя? Как неудобно!:}
              :]
           :}</span>
           <span style="color:#880088">{:
              Это правда, что вас зовут Петей?
              [:Правда:]
              [:Неправда:]
           :}</span>
           <span style="color:#000088">{:Неужели в самом деле Петей Вас зовут?
              [:В самом деле:]
              [:Нет, не в самом:]
           :}</span>
        :]

      </pre>
      <p>Для наглядности разные реплики выделены разными цветами.</p>
      <p>Предположим игрок выбрал действие "Меня зовут Петя". Какая из трёх реплик неписи должна быть выведена? Вот за это и отвечают настройки порядка вывода реплик.</p>
      <p><span class="emTEXT">shuffle:</span>   - настройка, определяющая выбор следующей реплики. Можно указать один из вариантов:</p>
      <div class="emTAB">
         <span class="emATTRIB">random</span>   - реплика неписи будет выбрана случайным образом.
         <br><span class="emATTRIB">straight</span>   - будет выбрана следующая реплика в порядке очереди. Т.е. если это первый выбор действия "Меня зовут Петя", будет выведена первая реплика (отмечена красным цветом), если игрок второй раз нажмёт на действие, будет выведена вторая реплика (отмечена фиолетовым цветом), и т.д.
      </div>
      <p><span class="emTEXT">repeat:</span>   - настройка, определяющая режим повтора реплик. Можно указать один из вариантов:</p>
      <div class="emTAB">
         <span class="emATTRIB">one</span>   - всякий раз при выборе этого действия будет выводиться одна и та же реплика. Например, была выставлена настройка <span class="emTEXT">shuffle:random</span>. Когда игрок выберет действие "Меня зовут Петя", случайным образом будет выбрана одна из реплик, и показана на экране. В следующий раз, когда игрок вновь выберет это же действие, вновь на экран будет выведена та же самая реплика.
         <br><span class="emATTRIB">once</span>   - реплики будут выводиться не повторяясь по одному разу. После вывода последней реплики всё время будет выводиться только она. Например, была выставлена настройка <span class="emTEXT">shuffle:straight</span>. Когда игрок выберет действие "Меня зовут Петя" первый раз, на экран будет выведена первая реплика (выделена красным цветом. Во второй раз появится вторая реплика (выделена фиолетовым), в третий раз - третья (синяя. Последняя реплика). В четвёртый, пятый и далее будет выводиться третья реплика.
         <br><span class="emATTRIB">cicle</span>   - реплики будут выводиться непрерывно по кругу. Если выставлена настройка <span class="emTEXT">shuffle:straight</span>, первый раз выведется первая реплика, второй раз - вторая, третий - третья, на четвёртый раз - вновь первая, потом снова: вторая, третья, первая, вторая... и т.д. Для настройки <span class="emTEXT">shuffle:random</span> выбор реплики несколько сложнее. Первый раз, когда игрок выберет действия, реплика определится случайным образом из трёх. На второй раз случайным образом выбирается одна из двух оставшихся реплик. Потом последняя оставшаяся. В четвёртый раз вновь происходит выбор случайным образом из трёх реплик, и т.д.
      </div>

      <h3>Чуть более сложные диалоги</h3>

      <h4>Корни, ветви и узлы</h4>
      <p>Для продолжения нам нужно разобраться в структуре диалогов и договориться о терминологии.</p>
      <p>Из предыдущего раздела мы узнали, как пишутся диалоги. Реплики персонажа помещаются между тегами "{:" и ":}", а реплики героя между "[:" и ":]". При этом реплики персонажа должны выводиться на экран автоматически, а реплики героя сначала представать в виде действий. Чтобы соотнести одни реплики с другими, мы научились "вкладывать" одни реплики в другие. Выбор одной из реплик приводит к выводу вложенных реплик, те в свою очередь тянут за собой ещё вложенные реплики и т.д.</p><p>Но с чего же модуль начинает? Должна же быть какая-то реплика, с которой начинается вывод всех остальных реплик. Да. Такая реплика есть, хотя до сих пор мы не называли её репликой и не использовали как реплику. Это реплика, которая не включается в теги и собственно вынесена из диалога. В ней прописываются все дефолтные настройки. Она называется корнем диалога, корневой репликой или заголовком диалога. Модуль не применяет к ней никаких настроек форматирования и все прописанные в ней фразы выводятся как есть, без имени персонажа или героя перед ними. Возьмём предпоследний пример и слегка его изменим, чтобы взглянуть на то, как выглядит корень диалога (подсвечен фиолетовым цветом):
      <pre class="emTEXT">
         <span style="color:#880088">npc="
         name:Ведущий:name
         ncolor:008888
         fcolor:008888
         "
         hero="
         name:Вася Пупкин:name
         "
         Это заголовок диалога. Его корень. Данные реплики будут выведены
         на экран как есть, без применения форматирования из настроек диалога.
         Тем не менее символы пробелов и табуляций перед строками, а так же
         лишние переводы строк будут удалены.</span>
         {:
            Как вас зовут?
            [:

            hero="ncolor:008800"
               Меня зовут Вася.
               {:Вас зовут Вася?
                  [:
                  npc="fcolor:880000"
                  Да, меня зовут Вася.
                     {:да ну нафиг:}
                     [:
                     нет. чистая правда
                     :]
                  :]
                  [:Нет, никто меня так не зовёт:]
               :}
               {:
                  Это правда, что вас зовут Васей?
                  [:Правда
                  :]
                  [:Неправда:]
               :}
            :]
            [:
            hero="ncolor:ff0000"
               Меня зовут Петя.
               {:
                  Вас зовут Петя?
                  [:Да{:Как это удобно!:}:]
                  [:
                     Нет
                     {:Вас зовут не Петя? Как неудобно!:}
                  :]
               :}
               {:
                  Это правда, что вас зовут Петей?
                  [:Правда:]
                  [:Неправда:]
               :}
               {:Неужели в самом деле Петей Вас зовут?
                  [:В самом деле:]
                  [:Нет, не в самом:]
               :}
            :]
         :}
      </pre>
      <p>Итак, корень - это реплика, которая помещена вне остального диалога, вне тегов, но меж тем в неё "помещены" все остальные реплики. Корень - это реплика, с которой начинается вывод диалога на экран. Естественно, если текст реплики отсутствует, на экран ничего не выводится, даже пустые строки.</p>
      <p>Когда модуль находит первую реплику диалога (его корень) и выводит её на экран (или не выводит, если фраза не прописана), он находит также и все вложенные реплики. В нашем примере он отыщет всего одну реплику "Как вас зовут?". Для наглядности я выделил её красным:
      <pre class="emTEXT">
         <span style="color:#880088">npc="
         name:Ведущий:name
         ncolor:008888
         fcolor:008888
         "
         hero="
         name:Вася Пупкин:name
         "
         Это заголовок диалога. Его корень. Данные реплики будут выведены
         на экран как есть, без применения форматирования из настроек диалога.
         Тем не менее символы пробелов и табуляций перед строками, а так же
         лишние переводы строк будут удалены.</span>
         <span style="color:#ff0000"">{:
            Как вас зовут?</span>
            [:

            hero="ncolor:008800"
               Меня зовут Вася.
               {:Вас зовут Вася?
                  [:
                  npc="fcolor:880000"
                  Да, меня зовут Вася.
                     {:да ну нафиг:}
                     [:
                     нет. чистая правда
                     :]
                  :]
                  [:Нет, никто меня так не зовёт:]
               :}
               {:
                  Это правда, что вас зовут Васей?
                  [:Правда
                  :]
                  [:Неправда:]
               :}
            :]
            [:
            hero="ncolor:ff0000"
               Меня зовут Петя.
               {:
                  Вас зовут Петя?
                  [:Да{:Как это удобно!:}:]
                  [:
                     Нет
                     {:Вас зовут не Петя? Как неудобно!:}
                  :]
               :}
               {:
                  Это правда, что вас зовут Петей?
                  [:Правда:]
                  [:Неправда:]
               :}
               {:Неужели в самом деле Петей Вас зовут?
                  [:В самом деле:]
                  [:Нет, не в самом:]
               :}
            :]
         <span style="color:#ff0000">:}</span>
      </pre>
      <p>Распознав тип этой реплики, модуль поймёт, что она должна быть выведена автоматически и повторит ту же процедуру, что проделал с корневой репликой, но на этот раз применит к ней настройки. Т.е. выведет фразу как реплику неписи. Затем он вновь проверит, нет ли в этой реплике вложенных и обнаружит целых две. Каждую из них я выделил отдельным цветом:
      <a name="easy_dialog_prove_version"></a><pre class="emTEXT">
         <span style="color:#880088">npc="
         name:Ведущий:name
         ncolor:008888
         fcolor:008888
         "
         hero="
         name:Вася Пупкин:name
         "
         Это заголовок диалога. Его корень. Данные реплики будут выведены
         на экран как есть, без применения форматирования из настроек диалога.
         Тем не менее символы пробелов и табуляций перед строками, а так же
         лишние переводы строк будут удалены.</span>
         <span style="color:#ff0000">{:
            Как вас зовут?
            <span style="color:#008888">[:hero="ncolor:008800"
               Меня зовут Вася.
               <span style="color:#008800">{:Вас зовут Вася?
                  [:
                  npc="fcolor:880000"
                  Да, меня зовут Вася.
                     <span style="color:#000000">{:да ну нафиг:}
                     [:нет. чистая правда:]</span>
                  :]
                  <span style="color:#000000">[:Нет, никто меня так не зовёт:]</span>
               :}
               {:
                  Это правда, что вас зовут Васей?
                  <span style="color:#000000">[:Правда
                  :]
                  [:Неправда:]</span>
               :}</span>
            :]</span>
            <span style="color:#ff8800">[:hero="ncolor:ff0000"
               Меня зовут Петя.
               <span style="color:#008800">{:
                  Вас зовут Петя?
                  [:Да<span style="color:#000000">{:Как это удобно!:}</span>:]
                  [:Нет
                     <span style="color:#000000">{:Вас зовут не Петя? Как неудобно!:}</span>
                  :]
               :}
               {:
                  Это правда, что вас зовут Петей?
                  <span style="color:#000000">[:Правда:]</span>
                  <span style="color:#000000">[:Неправда:]</span>
               :}
               {:Неужели в самом деле Петей Вас зовут?
                  <span style="color:#000000">[:В самом деле:]</span>
                  <span style="color:#000000">[:Нет, не в самом:]</span>
               :}</span>
            :]</span>
         :}</span>
      </pre>
      <p>Каждая из этих реплик появится в виде действия. Искать вложенные в них реплики не имеет смысла, пока игрок не выберет одно из действий, поэтому модуль пока остановится.</p>
      <p>Мы тоже остановимся, но совсем по другой причине. На этом примере мы увидели сразу два элемента диалога: узел и ветви. Узлом считается любая реплика, в которую "вложены" другие реплики. Не обязательно две. Может быть и одна, и три, и сто тысяч миллионов. Узлы различаются по типам точно так же, как и реплики: узел с репликой персонажа (актёрский узел) и узел с репликой героя (геройский узел, узел действия). Реплика, в которую не "вложено" ни одной другой реплики, называется финальной (последней, конечной. В нашем примере финальные реплики выделены чёрным цветом.). Две однотипные реплики, вложенные в одну реплику, считаются (и называются) ветвями диалога. Такие реплики называются одноуровневыми, то есть находящимися на одном уровне. Уровень реплики считается по количеству узлов, которые ей предшествовали. Поскольку корневой реплике не предшествует ни одного узла, она считается нулевым уровнем. Реплика "Как вас зовут?" из примера - первый уровень, и т.д.</p>
      <a name="head-hide-replics"></a><h4>Скрытый узел</h4>
      <p>Иногда нужно скрыть узел или целую ветку, чтобы она не выводилась ни при каких условиях, пока не будет осуществлён <a href="#prinuditelny_perehod" title="заголовок: Принудительные переходы и закрытие диалога" class="emHREF">принудительный переход</a>. Чтобы сделать это нужно завести пустой узел действия. Особенность работы модуля состоит в том, что он не выводит действия с пустым именем, поэтому в пустых узлах действий можно прятать другие реплики и целые ветви. Пример:
      <pre class="emTEXT">
         [:
            {: Скрытая реплика :}
            {: Ещё одна скрытая реплика :}
            {: А это целая скрытая ветка
               [:
                  Да, а вот и ответвление
                  {:И финальная реплика:}
               :]
               [:
                  Да, а вот и другое ответвление
                  {:И ещё одна финальная:}
               :]
            :}
         :]
      </pre>
      <h4>Ремарки</h4>

      <p>Ремарка - это авторский текст, который бывает нужно поместить между репликами. Специальных настроек для ремарок нет, но делать их, тем не менее, просто. Для этого в текущую реплику неписи или героя можно добавить реплику с настройками, отменяющими имя актёра и тире (код ремарки выделен голубым цветом):
      <pre class="emTEXT">
         {:
            npc="name:Ведущий:name"
            Как вас зовут?
            <span style="color:#008888">{:
               npc="name::name
               tire:nope"
               &lt;i&gt;
               Что Вы на это ответите?
               &lt;/i&gt;
            :}</span>
         :}
      </pre>
      <p>Ремарки желательно делать финальными репликами, хотя и не обязательно.</p>

      <h5>Ремарки внутри реплики</h5>

      <p>Ремарки внутри реплики - это некоторые авторские пояснения, которые нужно вывести непосредственно внутри реплики. Например, прервать речь актёра, чтобы пояснить, какое действие он выполняет, пока произносит фразу. Или указать с какой интонацией или силой произносится фраза. Вот примеры таких ремарок:</p>
      <div style="margin-left:3%;color:#000000;">
      <span style="color:#008888;font-weight:bold;">Мишель <span class="emREMARK">(громко)</span>:</span> — Яичница с ветчиной, это сколько?<br><br>
      <span style="color:#008800;font-weight:bold;">Мыса:</span> — На весну оставляю, <span class="emREMARK">— хныча, малец потёр багровое ухо. —</span> Голодно будет.
      </div>
      <p>В первом случае ремарка идёт сразу после имени и её отличие от имени в том, что она написана нежирным шрифтом, курсивом и серым цветом. Во втором случае ремарка прерывает прямую речь, и в отличие от прямой речи она написана курсивом и другим цветом. Последнюю сделать проще всего. Мы просто вставляем в фразу html-теги, которые изменят цвет и наклон текста:
      <pre class="emTEXT">
         {:
            npc="name:Мыса:name ncolor:008800 fcolor:000000 nattrib:-b-n fattrib:-n"
            На весну оставляю, &lt;i&gt;&lt;font color="#888888"&gt;— хныча, малец потёр багровое ухо. —&lt;/font&gt;&lt;/i&gt; Голодно будет.
         :}
      </pre>
      <p>Чтобы сделать ремарку для первого случая, можно прибегнуть к одной из хитростей. Например, можно задать персонажу пустое имя и полностью прописать строку реплики со всеми именами, тегами и пр.:
      <pre class="emTEXT">
         {:
            npc="name:Мишель:name ncolor:008888 fcolor:000000 nattrib:-b-n fattrib:-n"
            {:npc="name::name"
            &lt;font color="#008888"&gt;&lt;b&gt;Мишель &lt;/b&gt;&lt;i&gt;&lt;font color="#888888"&gt;(громко)&lt;/font&gt;&lt;/i&gt;&lt;b&gt;:&lt;/b&gt;&lt;/font&gt;&lt;font color="#000000"&gt; — Яичница с ветчиной, это сколько?&lt;/font&gt;
            :}
         :}
      </pre>
      <p>Или изменить имя персонажа на имя, в которое уже будет включена ремарка:
      <pre class="emTEXT">
         {:
            npc="name:Мишель:name ncolor:008800 fcolor:000000 nattrib:-n fattrib:-n"
            {:npc='name:Мишель &lt;/b&gt;&lt;i&gt;&lt;font color="#888888"&gt;(громко)&lt;/font&gt;&lt;/i&gt;&lt;b&gt;:name'
            Яичница с ветчиной, это сколько?
            :}
         :}
      </pre>
      <p>В последнем случае писанины меньше, однако нужно очень хорошо представлять себе, какие настройки применяются к имени.

      <a name="head-kak_izbezhat_o4istki_spiska_deystviy"></a><h4>Как избежать очистки списка действий</h4>

      <p>Особенность поведения модуля такова, что если узлом была реплика актёра, а ветвями являются реплики героя, производится очистка списка действий и вывод новых. Чтобы вывести новое действие при щелчке на одном из действий списка, но не удалять старые, помещать реплику героя следует непосредственно в предыдущую реплику героя. Так сделано в предпоследнем примере в реплике "Да, меня зовут Вася.":
      <pre class="emTEXT">
         [:   npc="fcolor:880000"
            Да, меня зовут Вася.

            {:да ну нафиг:}
            [:нет. чистая правда:]
         :]
      </pre>

      <h5>Удаление действия из списка</h5>

      <p>Иногда необходимо не добавлять действия, не удаляя прочие, а удалить одно действие из списка не обновляя список. Для этого была введена команда <span class="emCODE">selectact.delete</span>. Прописывать её можно только для реплик героя. </p>

      <h4>Блок последовательных реплик</h4>

      <p>Иногда нужно вывести сразу не одну, не две, а несколько реплик поочерёдно от героя и персонажа</p><p>Для примера возьмём вот такой отрывок:</p>
      <div style="margin-left:3%;margin-right:5%;color:#000000;">
         <span style="color:#008888;font-weight:bold;">Мишель <span style="font-weight:normal;">(громко)</span>:</span> Яичница с ветчиной, это сколько?
         <br><span style="color:#888888;font-weight:bold;">Женский голос <span style="font-weight:normal;">(громко)</span>:</span> Сто восемьдесят.
         <br><span style="font-style:italic;">Мишель поворачивается лицом к стойке.</span>
         <br><span style="color:#008888;font-weight:bold;">Мишель:</span> Ладно. Делайте.
         <br><span style="color:#888888;font-weight:bold;">Женщина:</span> Хорошо.
      </div>
      <p>У нас два собеседника: Женщина и Мишель. Пусть неписью побудет Мишель, а героем - Женщина.</p><p>Как обычно, для реплики мы задаём настройки:
      <pre class="emTEXT">
         npc="name:Мишель:name ncolor:008888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
         hero="name:Женщина:name ncolor:888888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
      </pre>
      <p>Если бы мы использовали только возможность вкладывать одну реплику в другую, мы могли бы написать этот диалог так:
      <pre class="emTEXT">
         npc="name:Мишель:name ncolor:008888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
         hero="name:Женщина:name ncolor:888888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
         {:npc="name::name"
         &lt;font color="#008888"&gt;&lt;b&gt;Мишель&lt;/b&gt; (громко)&lt;b&gt;:&lt;/b&gt;&lt;/font&gt; &lt;font color="#000000"&gt;Яичница с ветчиной, это сколько?&lt;/font&gt;
            {:
            &lt;font color="#888888"&gt;&lt;b&gt;Женский голос&lt;/b&gt; (громко)&lt;b&gt;:&lt;/b&gt;&lt;/font&gt; &lt;font color="#000000"&gt;Сто восемьдесят.&lt;/font&gt;
               {:
               &lt;i&gt;Мишель поворачивается лицом к стойке.&lt;/i&gt;
                  {:npc="name:Мишель:name tire:&amp;nbsp;"
                     Ладно. Делайте.
                     {:npc="name:Женщина:name ncolor:888888 fcolor:000000 tire:&amp;nbsp;"
                        Хорошо.
                     :}
                  :}
               :}
            :}
         :}
      </pre>
      <p>Но это не только громоздко, но ещё и неудобно, и даёт дополнительную нагрузку на плеер. Специально для таких случаев была придумана конструкция блоков реплик (блок фраз). Делается она очень просто. Между тегами <tt>frase-block: :frase-block</tt> помещаются строки нашего диалога. Каждая строка считается отдельной фразой/репликой. Если в начале строки вписать <tt>&lt;npc-name&gt;</tt>, то к строке будет применено форматирование согласно настройкам неписи. Если в начале строки указать  <tt>&lt;hero-name&gt;</tt>, то к ней будет применено форматирование согласно настройками героя. Если ни той ни другой метки в строке не обнаружено, дополнительное форматирование к строке не применяется. Таким образом наш диалог можно записать в одну "реплику":
      <pre class="emTEXT">
         npc="name:Мишель:name ncolor:008888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
         hero="name:Женщина:name ncolor:888888 nattrib:-b-n fcolor:000000 fattrib:-n tire:nope"
         {:
            frase-block:
               &lt;font color="#008888"&gt;&lt;b&gt;Мишель&lt;/b&gt; (громко)&lt;b&gt;:&lt;/b&gt;&lt;/font&gt; &lt;font color="#000000"&gt;Яичница с ветчиной, это сколько?&lt;/font&gt;
               &lt;font color="#888888"&gt;&lt;b&gt;Женский голос&lt;/b&gt; (громко)&lt;b&gt;:&lt;/b&gt;&lt;/font&gt; &lt;font color="#000000"&gt;Сто восемьдесят.&lt;/font&gt;
               &lt;i&gt;Мишель поворачивается лицом к стойке.&lt;/i&gt;
               &lt;npc-name&gt;Ладно. Делайте.
               &lt;hero-name&gt;Хорошо.
            :frase-block
         :}
      </pre>
      <p>Фразы, указанные в блоке, будут выводиться одна за другой с небольшой задержкой. Блок фраз имеет приоритет перед простым текстом реплики.</p>
      <h4>Реплики по условию</h4>
      <p>Иногда нам необходимо намеренно скрыть реплику до тех пор, пока не будет выполнено определённое условие. Например, реплика должна появляться только в тех случаях, когда в рюкзаке героя есть "Странный синий камушек", а до той поры быть скрыта. Чтобы написать такую скрытую реплику, используем специальные теги <tt>iffing:&nbsp;:iffing</tt>. Если Вы не первый день пользуетесь QSP, Вы знаете, что такое оператор условия и уже видели конструкции типа:
      <pre class="emTEXT"><b>
         <span class="emOPRT">if <span class="emFUNC">obj</span><span style="color:#0000ff">(<span class="emTEXT">'Странный синий камушек'</span>)</span>:</span>
            <span class="emCOMMENT">! ---- какой-то код .... ---------</span>
         <span class="emOPRT">end</span>
      </b></pre>
      <p>Так вот. Между тегами <tt>iffing:&nbsp;:iffing</tt> нужно поместить всё, что находилось бы в этой конструкции между "<span class="emATTRIB">if</span>" и "<span class="emATTRIB">:</span>". То есть реплика по условию выглядела бы так:
      <pre class="emTEXT">
         {:
            iffing:<span class="emFUNC">obj</span><span style="color:#0000ff">(<span class="emTEXT">'Странный синий камушек'</span>)</span>:iffing
            О, я вижу ты нашёл странный синий камушек!
         :}
      </pre>
      <P>Или так:
      <pre class="emTEXT">
         [:
            iffing:<span class="emFUNC">obj</span><span style="color:#0000ff">(<span class="emTEXT">'Странный синий камушек'</span>)</span>:iffing
            Не знаешь, что это за странный синий камушек?
         :]
      </pre>
      <p>Используя подобную возможность, следует помнить, что все реплики, "вложенные" в реплику, выводимую по условию, окажутся недоступны до выполнения условия.</p>
      <h4>Выполнение кода при выводе реплики</h4>
      <p>Иногда при выводе реплики нужно выполнить какой-нибудь код. Особенно часто это бывает необходимо при выборе действия (выводится реплика героя). На такой случай предусмотрены специальные теги <tt>dynamic-code:&nbsp;:dynamic-code</tt>. Между ними можно разместить любой код QSP, который будет выполнен только при выводе реплики на экран. Если текст реплики не задан, на экран, конечно, ничего не выведется, но код всё равно будет выполнен. Код выполняется непосредственно перед выводом реплики на экран, поэтому если Вы пропишете вывод строки из кода, строка появится на экране до выводимой реплики. Вот пример вывода ремарки до реплики, используя код в реплике.
      <pre class="emTEXT">
         {:
            dynamic-code:
            *pl '&lt;i&gt;&lt;font color="#888888"&gt;Мишель поворачивается лицом к стойке.&lt;/font&gt;&lt;/i&gt;'
            :dynamic-code:
            Ладно. Делайте.
         :}
      </pre>
      <a name="prinuditelny_perehod"></a>
      <h4>Принудительные переходы по репликам. Закрытие диалога</h4>
      <p>Принудительные переходы по репликам можно вставлять на любой реплике. Такие переходы не зависят от выполнения условий вывода реплики, можно перейти даже на <a href="#head-hide-replics" class="emHREF" title="заголовок: Скрытый узел">скрытые реплики</a>. Однако не рекомендуется злоупотреблять переходами, иначе можно создать непрямое зацикливание. Принудительные переходы необходимы, если Вам нужно переключиться на другую ветку диалога, или вернуться на пару узлов обратно. Можно выполнить переходы сразу на несколько реплик одновременно, однако не стоит забывать об <a href="#head-kak_izbezhat_o4istki_spiska_deystviy" class="emHREF" title="заголовок: Как избежать очистки списка действий">очистке списка действий и порядке его осуществления</a>.</p><p>Для переходов по репликам используются следующие команды:</p>
      <div class="emTAB">
         <span class="emCODE"><span class="emTEXT">levelup:</span>##</span>   —   переход по узлам "назад". Вместо "решёток" указывается на сколько узлов нужно вернуться по репликам. Тип реплик при этом не учитывается. К примеру:
         <pre class="emTEXT">
            replics="repeat:cicle
            shuffle:random"
            npc="name:Ведущий:name
            ncolor:008888
            fcolor:008888"
            hero="name:Вася пупкин:name"
            {:<span style="color:#999900">marker:firstqst</span>
            Как вас зовут?
               [:Меня зовут Вася.
                  {:
                     Вас зовут Вася?
                     [:Да, меня зовут Вася.:]
                     <span style="color:#0000ff">[:Нет, никто меня так не зовёт
                     <span style="color:#004444">levelup:5</span>:]</span>
                  :}
                  {:
                     Это правда, что вас зовут Васей?
                     [:Правда:]
                     <span style="color:#ff0000">[:Неправда
                     <span style="color:#004444">levelup:3</span>:]</span>
                  :}
               :]
               [:
                  Меня зовут Петя.
                  {:
                     Вас зовут Петя?
                     [:Да{:Как это удобно!:}:]
                     [:Нет
                        <span style="color:#004444">levelup:3</span>
                        {:Вас зовут не Петя? Как неудобно!:}
                     :]
                  :}
                  {:
                     Это правда, что вас зовут Петей?
                     [:Правда:]
                     <span style="color:#dd00dd">[:Неправда
                     <span style="color:#004444">leveljump:firstqst</span>:]</span>
                  :}
                  {:Неужели в самом деле Петей Вас зовут?
                     [:В самом деле
                     <span style="color:#004444">closeup</span>:]
                     [:Нет, не в самом
                     <span style="color:#004444">levelup:3</span>:]
                  :}
               :]
            :}
         </pre>
         <p>Здесь можно видеть несколько переходов по узлам, они выделены тёмно-голубым цветом. Сначала рассмотрим два из них.</p>
         <p>Реплика "Неправда" (подсвечена красным цветом) должна осуществлять переход на три узла назад. Она вложена в реплику "Это правда, что вас зовут Васей?", которую произнёс актёр. То есть это один уровень назад. Реплика "Это правда, что вас зовут Васей?" вложена в реплику "Меня зовут Вася", которую произнёс герой. Это два уровня назад. Эта реплика, в свою очередь, вложена в реплику неписи "Как вас зовут?". Она и будет репликой, на которую осуществится принудительный переход - три узла назад.</p>
         <p>Реплика "Нет, никто меня так не зовёт" (подсвечена синим цветом) должна осуществлять переход на пять узлов назад. Однако это невозможно, поскольку ей предшествовало всего четыре реплики, включая корневую. Переместиться на корневую реплику нельзя, поэтому будет осуществлено перемещение на реплику первого уровня "Как вас Зовут?".</p>
      </div>
      <div class="emTAB">
         <span class="emCODE"><span class="emTEXT">leveljump:</span>MARKER</span>   —   переход минуя все условия и промежуточные узлы на реплику с указанной меткой.
         <P>Вместо "<span class="emCODE">MARKER</span>" указывается метка. Чтобы поставить метку на реплике, нужно использовать одиночный тег <span class="emFUNC">marker:</span>, после которого следует прописать без пробелов любое сочетание символов (можно использовать только буквы и цифры и символ подчёркивания). Эти символы и будут меткой. Пример реплики, осуществляющей переход на метку, выделен фиолетовым цветом в предыдущем примере. Сама метка выделена жёлтым цветом.</P>
         <p>Если указанная в <span class="emTEXT">leveljump:</span> метка отсутствует, переход не осуществится.</p>
         <p>Чтобы осуществить переход сразу на несколько реплик, нужно указать для каждой из этих реплик одинаковые метки, а потом для реплики, с которой нужно перейти, указать команду <span class="emTEXT">leveljump:</span> и эту метку. Либо выставить для каждой реплики свою собственную метку, а потом прописать в реплике, с которой нужно перейти, команду <span class="emTEXT">leveljump:</span> столько раз на сколько реплик нужно перейти, с указанием каждой выставленной метки. Разница между двумя этими способами в том, что во втором случае Вы можете контролировать порядок вызова реплик. Вот оба варианта для сравнения:</p>
         <table cellpadding="5" cellspacing="5" border="0">
            <tr>
               <td width="50%">
                  <pre class="emTEXT">
      replics="repeat:cicle
      shuffle:random"
      npc="name:Ведущий:name
      ncolor:008888
      fcolor:008888"
      hero="name:Вася пупкин:name"
      {:
         <span style="color:#999900">marker:firstqst</span>
         Как вас зовут?
         [:
            Меня зовут Петя.
            {:
               Вас зовут Петя?
               [:Да{:Как это удобно!:}:]
               [:Нет
                  <span style="color:#004444">levelup:3</span>
                  {:Вас зовут не Петя? Как неудобно!:}
               :]
            :}
            {:
               Это правда, что вас зовут Петей?
               [:Правда:]
               <span style="color:#dd00dd">[:Неправда
               <span style="color:#004444">leveljump:firstqst</span>:]</span>
            :}
            {:Неужели в самом деле Петей Вас зовут?
              [:В самом деле
                 <span style="color:#004444">closeup</span>
              :]
              [:Нет, не в самом
                 <span style="color:#004444">levelup:3</span>
              :]
            :}
         :]
         [:
            {:А здесь у нас скрытая реплика
               <span style="color:#999900">marker:firstqst</span>
            :}
         :]
      :}
               </pre>
            </td>
            <td>
               <pre class="emTEXT">
      replics="repeat:cicle
      shuffle:random"
      npc="name:Ведущий:name
      ncolor:008888
      fcolor:008888"
      hero="name:Вася пупкин:name"
      {:
         <span style="color:#999900">marker:firstqst</span>
         Как вас зовут?
         [:
            Меня зовут Петя.
            {:
               Вас зовут Петя?
               [:Да{:Как это удобно!:}:]
               [:Нет
                  <span style="color:#004444">levelup:3</span>
                  {:Вас зовут не Петя? Как неудобно!:}
               :]
            :}
            {:
               Это правда, что вас зовут Петей?
               [:Правда:]
               <span style="color:#dd00dd">[:Неправда
               <span style="color:#004444">leveljump:firstqst</span>
               <span style="color:#004444">leveljump:hidereplics</span>
               :]</span>
            :}
            {:Неужели в самом деле Петей Вас зовут?
               [:В самом деле
               <span style="color:#004444">closeup</span>:]
               [:Нет, не в самом
               <span style="color:#004444">levelup:3</span>:]
            :}
         :]
         [:
            {:А здесь у нас скрытая реплика
               <span style="color:#999900">marker:hidereplics</span>
            :}
         :]
      :}
                  </pre>
               </td>
            </tr>
         </table>
         <P>В первом случае модуль сам отыщет первую реплику, которую выведет. Скорей всего это будет реплика с наивысшим уровнем. Во втором случае сначала будет осуществлён переход на реплику с меткой <span class="emCODE">firstqst</span>, а затем на реплику с меткой <span class="emCODE">hidereplics</span>. Т.е. именно в том порядке, в котором записаны команды <span class="emCODE">leveljump:</span> в реплике "Неправда", выделенной фиолетовым цветом.</P>
      </div>
      <P>Чтобы принудительно закрыть диалог из реплики, нужно ввести команду <span class="emCODE">closeup</span>. В последних примерах реплика "В самом деле" будет закрывать диалог. При закрытии диалога восстановится описание и действия локации, с которой диалог был вызван.</P>

      <h4>Названия действий</h4>

      <p>по умолчанию, в качестве названия действия выступает полный текст реплики. Это не всегда удобно. Иногда нужно вывести <i>очень</i> длинную реплику, полный текст которой будет смотреться неуместно в названии действия. На такой случай в модуле предусмотрена конструкция <span class="emCODE">act-name:&nbsp;:act-name</span>. Текст, помещённый между этими двумя тегами, будет использоваться в качестве названия действия. Пример:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
            act-name:Вася:act-name
            Вообще моё имя - Василий. Но друзья зовут меня - Вася...
            :]
         :}
      </pre>
      <P>В этом диалоге на экран сначала выведется реплика "Как вас зовут?" и действие с названием "Вася". При щелчке по действию, на экране появится реплика "Вообще моё имя - Василий. Но друзья зовут меня - Вася...".</P>
      <p>Всё довольно просто. Когда нам нужно вывести название действия, отличное от произносимой реплики, используем эту конструкцию.</p>
      <p>Эту же конструкцию следует использовать, если в узле действия Вы использовали конструкцию вывода блока фраз <span class="emCODE">frase-block:&nbsp;:frase-block</span>. Однако здесь можно написать и обыкновенную реплику без тегов <span class="emCODE">act-name:&nbsp;:act-name</span>, и она выведется в названии действия. Чтобы было понятнее, пример, когда в качестве названия действия выводится реплика:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
            Меня зовут Вася.
            :]
            [:
            Я стесняюсь...
            frase-block:
               &lt;hero-name&gt;Мне так неловко...
               &lt;npc-name&gt;Отчего же?
               &lt;hero-name&gt;Моё имя так необычно звучит...
               &lt;npc-name&gt;Ну же, смелее!
               &lt;hero-name&gt;Вартасахан Бздюльгахаев!
               &lt;hero-name&gt;Можно просто: Вася.
            :frase-block
            :]
         :}
      </pre>
      <p>Пример, когда в качестве названия действия, будет выведен текст, помещённый между <span class="emCODE">act-name:&nbsp;:act-name</span>:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
            act-name:Вася:act-name
            Меня зовут Вася.
            :]
            [:
            act-name:Мне неловко...:act-name
            Я стесняюсь...
            frase-block:
               &lt;hero-name&gt;Мне неловко...
               &lt;npc-name&gt;Отчего же?
               &lt;hero-name&gt;Моё имя так необычно звучит...
               &lt;npc-name&gt;Ну же, смелее!
               &lt;hero-name&gt;Вартасахан Бздюльгахаев!
               &lt;hero-name&gt;Можно просто: Вася.
            :frase-block
            :]
         :}
      </pre>
      <p>Пример, когда название у действия будет, но реплику герой не произнесёт:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
            act-name:Вася:act-name
               {:npc="name::name"
               <span style="font-style:italic;">
               Он бы мог сказать, что его зовут Вася. Но на самом деле его звали Вартасахан.
               </span>
               :}
            :]
         :}
      </pre>
      <p>И напоследок. Блок фраз, который не появится в виде действия, потому что неоткуда извлечь название действия:
      <pre class="emTEXT">
         {:
            Как вас зовут?
            [:
            frase-block:
               &lt;hero-name&gt;Мне неловко...
               &lt;npc-name&gt;Отчего же?
               &lt;hero-name&gt;Моё имя так необычно звучит...
               &lt;npc-name&gt;Ну же, смелее!
               &lt;hero-name&gt;Вартасахан Бздюльгахаев!
               &lt;hero-name&gt;Можно просто: Вася.
            :frase-block
            :]
         :}
      </pre>

      <h4>Комментирование реплик</h4>
      <p>Все реплики можно комментировать. Комментарии записываются так же, как записываются в обычном html-документе, т.е. внутри конструкции <span class="emCOMMENT">&lt;!--&nbsp;--&gt;</span>. Перед выводом реплик все подобные конструкции будут удалены. Комментарии главным образом предназначены для помещения в них настроек и прочих текстов, которые не должны входить в реплику. Конечно, настройки можно указывать и не в комментариях, но если разместить их внутри комментария, обработка каждой реплики сократится на несколько миллисекунд. При больших уровнях вложенности это может существенно сократить время вывода всех реплик на экран. Все конструкции, расширяющие реплику, такие как <span class="emCODE">frase-block:&nbsp;:frase-block</span>, <span class="emCODE">act-name:&nbsp;:act-name</span>, <span class="emCODE">iffing:&nbsp;:iffing</span>, и др., можно и нужно размещать в комментариях. Лучше всего всё это уместить в одном комментарии.</p><p>Запрещено вкладывать комментарии в конструкции <span class="emCODE">iffing:&nbsp;:iffing</span> и <span class="emCODE">dynamic-code:&nbsp;:dynamic-code</span>, а так же вкладывать комментарии в комментарии. Вот пример неправильного размещения комментариев (подсвечены красным цветом):
      <pre class="emTEXT">
         <span class="emCOMMENT">&lt;!-- npc="
         name:Ведущий:name
         ncolor:008888<span style="color:#ff0000">&lt;!-- цвет имени неписи --&gt;</span>
         fcolor:008888
         "
         hero="
         name:Вася Пупкин:name
         "
         --&gt;</span>
         {:
            Как вас зовут?
            [:

            hero="ncolor:008800"
               Меня зовут Вася.
               {:
               iffing:a=0<span style="color:#ff0000">&lt;!-- реплика выводится, если "a" равно нулю --&gt;</span>:iffing
               dynamic-code:a=1:dynamic-code<span class="emCOMMENT">&lt;!-- изменяем значение "a", чтобы реплика больше не выводилась --&gt;</span>
               Вас зовут Вася?
                  [:
                  npc="fcolor:880000"
                  Да, меня зовут Вася.
                     {:да ну нафиг:}
                     [:
                     нет. чистая правда
                     :]
                  :]
                  [:Нет, никто меня так не зовёт:]
               :}
               {:
               iffing:a>0:iffing<span class="emCOMMENT">&lt;!-- реплика выводится, если "a" больше нуля --&gt;</span>
               dynamic-code:if a&lt;5: a+=1<span style="color:#ff0000">&lt;!-- изменяем значение "a", чтобы реплика больше не выводилась --&gt;</span>:dynamic-code
                  Это правда, что вас зовут Васей?
                  [:Правда
                  :]
                  [:Неправда:]
               :}
            :]
         :}
      </pre>
      <p>Сами реплики в комментарии не помещаются.</p>
      <p>Если комментарий разместить, например, в блоке фраз, то он будет проигнорирован html-рендерером, поскольку написан по правилам комментариев в html.</p>
      <hr>
      <p>Примечания:</p>
      <p><a name="prim1"></a>[1] <a href="#backprim1" class="emHREF" title="Назад"><sup>&uarr;</sup></a> Возможно так же написание с использованием одиночного апострофа: <span class="emCODE">npc='&nbsp;' hero='&nbsp;' replics='&nbsp;'</span></p>
      <div class="postcont">
         <br><br><br>Aleks Versus'easy.libraries'2017<br>Aleks Versus'GAM'RUS'2017
      </div>
   </div>
</body>
</html>
