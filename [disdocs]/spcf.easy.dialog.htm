<html>
	<head>
		<html>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<STYLE TYPE="text/css">
		<!--
			@page { size: 21cm 29.7cm; margin: 2cm }
			p { margin-left: 0.75cm }
			h1 { color:000000 }
			h2 { color:884400 }
			h3 { color:004400 }
			h4 { color:004444 }
			tt {color:000000;}
			.citata	{color:444444; background-color:eeffff; font-style:italic; margin-left: 1.0cm;}
			.zdvig	{margin-left: 0.50cm; text-indent: 0.50cm}
			.termin {text-indent:-1.50cm}
		-->
		</STYLE>
	</head>
	<body>
		<center><h1>easy.dialog.qsp v 2.0</h1></center>
		<center>Модуль интерпретации диалогов.</center><br><br>
		<table width=80% border="1" cellpadding="50" cellspacing="0"  bgcolor="F0E68C" align="center"><tr><td align="justify" valign="top">

<a name="short-specification"></a><h2>Краткое описание</h2>

	<a name="terms"></a><h3>Термины и понятия</h3>

		<p class="termin"><font color="004444"><b>Тег</b></font> — особая метка в тексте, отмечающая вхождение рассматриваемого текста. Теги могут быть открывающие и закрывающие, а так же одиночные. Комплекс из открывающего и закрывающего тегов может называться двойным тегом или сдвоенным тегом.</p>
		<p class="termin"><font color="004444"><b>Содержимое тега</b></font> — рассматриваемый текст, место вхождения которого обозначено тегами или тегом. Может использоваться понятие "значение тега". Числовое значение здесь условно обозначается <tt>[#значение]</tt>, а текстовое - <tt>[$значение]</tt>. Вместо слова "значение" может употребляться "число", "текст", "шестнадцатеричное число", и другие слова и словосочетания. Если содержимое тега принимает конечное число значений, это будет показано перечислением этих значений через вертикальную черту в квадратных скобках <tt>[одно значение|второе значение|третье значение]</tt>.</p>
		<p class="termin"><font color="004444"><b>Команда</b></font> — слово или группа слов, которые провоцируют выполнение определённых операций или действий, запуск механизмов.</p>
		<p class="termin"><font color="004444"><b>Конструкция</b></font> — текст, записанный по определённым правилам.</p>
		<p class="termin"><font color="004444"><b>Реплика</b></font> — текст, заключённый между тегами реплик. Может включать в себя произносимую фразу, другие теги, команды, конструкции.</p>
		<p class="termin"><font color="004444"><b>Герой</b></font> — персонаж, которым непосредственно управляет игрок.</p>
		<p class="termin"><font color="004444"><b>Актёр</b></font> — персонаж, которым игрок не может управлять непосредственно.</p>
		<p class="termin"><font color="004444"><b>Текст реплики</b></font> — фраза героя или актёра, которая будет выведена на экран после обработки реплики. Текст реплики (иногда называется просто "фраза") - единственное содержимое реплики, которое не нужно облекать в специальные конструкции, или помещать между тегами.</p>
		<p class="termin"><font color="004444"><b>Интерпретация реплики</b></font> — процесс извлечения всех конструкций и текста реплики из реплики, а так же выполнение конструкций и команд, воспроизведение фразы в виде текста, выводимого на экран. За интерпретацию реплики отвечает процедура <tt><b><font color="000088">dialog.replic.int</font></b></tt>.</p>
		<p class="termin"><font color="004444"><b>Пустая реплика</b></font> — реплика, в которой отсутствует фраза.</p>
		<p class="termin"><font color="004444"><b>Узел</b></font> — реплика, в которую вложена другая реплика.</p>
		<p class="termin"><font color="004444"><b>Родительская реплика</b></font> — так называется узел по отношению к реплике, которая в него вложена. <i>Реплика "F" - родительская реплика реплики "A".</i> Ещё называется родителем. Всякий узел является родителем вложенной в него реплики.</p>
		<p class="termin"><font color="004444"><b>Дочерняя реплика</b></font> — так называется реплика по отношению к реплике, в которую она вложена. <i>Реплика "A" - дочерняя реплика реплики "F".</i> Всякая реплика, вложенная в узел, является дочерней.</p>
		<p class="termin"><font color="004444"><b>Корень</b></font> — текст, помещённый вне тегов реплик. Может называться также корневой репликой, нулевой репликой, начальной репликой или заголовком диалога.</p>
		<p class="termin"><font color="004444"><b>Дефолтное значение</b></font> — значение тега, которое было указано в заголовке диалога, либо значение по умолчанию.</p>
		<p class="termin"><font color="004444"><b>Значение по умолчанию</b></font> — значение, которое будет возвращено механизмом модуля easy.dialog, если не указано, или ошибочно указано другое значение. Значения по умолчанию встроены в движок.</p>
		<p class="termin"><font color="004444"><b>Уровень</b></font> — счёт вложений реплик, степень вложения реплики. Если реплика вложена в корень - первый уровень. Если реплика вложена в реплику, вложенную в корень, - второй уровень. И так далее. Верхним уровнем при этом считается корень.</p>
		<p class="termin"><font color="004444"><b>Ответвления</b></font> — одноуровненвые реплики, вложенные в один и тот же узел.</p>
		<p class="termin"><font color="004444"><b>Ветка</b></font> — ответвление вместе со всеми вложенными в него репликами.</p>
		<p class="termin"><font color="004444"><b>Финал</b></font> — реплика, в которую не вложено ни одной другой реплики. Называется так же финальной репликой, конечной репликой, или последней репликой.</p>
		<p class="termin"><font color="004444"><b>Тело диалога</b></font> — текст, содержащий хотя бы одну реплику помимо корня.</p>

	<a name="tags-constructions-commands"></a><h3>Теги, конструкции, команды</h3>

		<p><tt><font color="008800"><b>{:</b></font>[$текст]<font color="008800"><b>:}</b></font></tt> — теги, между которыми записываются реплики неиграбельных персонажей (далее: актёры, неписи, NPC, персонажи). Текст реплики выводится на экран автоматически. Теги реплики актёра.</p>
		<p><tt><font color="008800"><b>[:</b></font>[$текст]<font color="008800"><b>:]</b></font></tt> — теги, между которыми записываются реплики персонажа, которым управляет игрок (далее - герой). Выводятся на экран в виде доступных игроку действий. При выборе действия, на экран выводится текст реплики. Теги реплики героя.</p>
		<p><tt><font color="008800"><b>npc="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> — конструкция, в которую помещаются настройки вывода фраз актёра.</p>
		<p><tt><font color="008800"><b>hero="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> — конструкция, в которую помещаются настройки форматирования и формирования фраз героя.</p>
		<div style="margin-left:0.75cm">
			Настройки формирования и форматирования фраз актёров и героя:
			<p><tt><font color="008888"><b>name:</b></font>[$значение]<font color="008888"><b>:name</b></font></tt> — двойной тег установки имени актёра или героя (в зависимости от того, в какую конструкцию помещено). Если указать пустое значение (между двоеточиями нет ничего), имя не будет выводиться. Если не указывать, будет выводиться имя, указанное в родительской реплике, либо дефолтное имя. Значением может быть любое сочетание пробельных и непробельных символов. Не рекомендуется использовать символ перевода строки.</p>
			<p><tt><font color="008888"><b>ncolor:</b></font>[$значение]</tt> — одиночный тег настройки цвета имени актёра или героя (в зависимости от того, в какую конструкцию помещено). Значением может выступать запись из шести шестнадцатеричных цифр. Формат цвета как в html: <b><font color="ff0000">rr</font><font color="008800">gg</font><font color="0000ff">bb</font></b>. Если не указывать, или оставить значение пустым, будет выводиться значение родительской реплики, или дефолтное.</p>
			<p><tt><font color="008888"><b>fcolor:</b></font>[$значение]</tt> — одиночный тег настройки цвета непосредственно фразы актёра или героя (в зависимости от того, в какую конструкцию помещено). Значением может выступать запись из шести шестнадцатеричных цифр. Формат цвета как в html: <b><font color="ff0000">rr</font><font color="008800">gg</font><font color="0000ff">bb</font></b>. Если не указывать, или оставить значение пустым, будет выводиться значение родительской реплики, или дефолтное.</p>
			<p><tt><font color="008888"><b>nattrib:</b></font>[$значение]</tt> — одиночный тег настройки стиля начертания шрифта имени актёра или героя (в зависимости от того, в какую конструкцию помещено). Значением выступают команды аттрибутов, в любом количестве. Если не указывать, или оставить значение пустым, будет выводиться значение родительской реплики, или дефолтное.</p>
			<p><tt><font color="008888"><b>fattrib:</b></font>[$значение]</tt> — одиночный тег настройки стиля начертания шрифта фразы актёра или героя (в зависимости от того, в какую конструкцию помещено. Значением выступают команды аттрибутов, в любом количестве. Если не указывать, или оставить значение пустым, будет выводиться значение родительской реплики, или дефолтное.):
				<div style="margin-left:0.75cm">
					<p><tt><font color="0000ff"><b>-b</b></font></tt> — команда аттрибута, применяющая жирность к тексту.<br>
					<tt><font color="0000ff"><b>-i</b></font></tt> — команда аттрибута, применяющая курсив к тексту.<br>
					<tt><font color="0000ff"><b>-n</b></font></tt> — команда аттрибута, отменяющая жирность и курсив.</p>
					<p>Аттрибуты считываются в обратном порядке, начиная с последнего, таким образом происходит и применение. Допустим, мы не хотим, чтобы имя героя отображалось курсивом, но продолжало отображаться жирным шрифтом. Пишем "natrib:-b-n". Сначала шрифт вернётся к нормальному виду, потом будет применена жирность. Если указать "natrib:-n-b", то сначала будет применена жирность, а потом шрифт вернётся к нормальному виду. </p>
				</div>
			</p>
			<p><tt><font color="008888"><b>tire:</b></font>[$значение]</tt> — одиночный тег, значение которого определяет символ, выводимый перед фразой (знак мыслеотделительный, знак перед прямой речью). Если не указано, выводится значение родительской реплики, или дефолтное. Если тег и его значение отделяются от остального текста пробелами, можно указывать только непробельные символы. Чтобы использовать пробельные символы в качестве знака перед прямой речью, следует поместить тег и его значение в круглые скобки:<br><tt>(<font color="008888"><b>tire:</b></font>[$значение])</tt></p><p>Чтобы перед прямой речью не ставилось никаких знаков, следует использовать команду <tt><font color="0000ff"><b>nope</b></font></tt>:<br>
			<tt><b><font color="008888">tire:</font><font color="0000ff">nope</font></b></tt>
			</p>
		</div>
		<p><tt><font color="008800"><b>replics="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> — конструкция, в которую помещаются настройки выбора, обработки и вывода реплик.</p>
		<div style="margin-left:0.75cm">
			Настройки выбора, обработки и вывода реплик актёров и героя:
			<p><tt><font color="008888"><b>repeat:</b></font>[one|once|cicle]</tt> — одиночный тег, значение которого определяет настройки повтора фраз актёра из ответвлений. Можно использовать три команды:
				<div style="margin-left:0.75cm">
					<p><tt><font color="0000ff"><b>one</b></font></tt> — всё время диалога будет выводиться фраза только одного из ответвлений.<br>
					<tt><font color="0000ff"><b>once</b></font></tt> — всякий раз будет выводиться фраза из ответвления, фраза которого ещё не выводилась. Когда такие ответвления закончатся, будет выводиться фраза ответвления, фраза из которого выводилась последний раз.<br>
					<tt><font color="0000ff"><b>cicle</b></font></tt> — всякий раз будет выводиться фраза из следующего ответвления. Когда закончатся ответвления, фразы из которых ещё не выводились, выбор следующего ответвления пойдёт с начала.</p>
				</div>
			</p>
			<p><tt><font color="008888"><b>repeat:</b></font>[random|straight]</tt> — одиночный тег, значение которого определяет настройки выбора следующего ответвления для реплик актёра. Можно использовать две команды:
				<div style="margin-left:0.75cm">
					<p><tt><font color="0000ff"><b>random</b></font></tt> — случайный выбор ответвления.<br>
					<tt><font color="0000ff"><b>straight</b></font></tt> — выбор следующего ответвления в порядке очереди, в которой они записаны в теле диалога.</p>
				</div>
			</p>
		</div>
		<p><tt><font color="008800"><b>iffing:</b></font>[$условия]<font color="008800"><b>:iffing</b></font></tt> — сдвоенный тег, значение которого используется в качестве условия вывода реплики.</p>
		<p><tt><font color="008800"><b>act-name:</b></font>[$текст]<font color="008800"><b>:act-name</b></font></tt> — сдвоенный тег, значение которого используется в качестве названия действия при интерпретации реплики героя.</p>
		<p><tt><font color="008800"><b>frase-block:</b></font>[$текст]<font color="008800"><b>:frase-block</b></font></tt> — конструкция вывода блока последовательных фраз. Между тегами размещается набор строк, каждая из которых считается отдельной фразой. При этом если в начале фразы выставлен тег <tt><font color="660066"><b>&lt;npc-name&gt;</b></font></tt>, к ней применяются настройки фразы актёра, если же в начале фразы выставлен тег <tt><font color="660066"><b>&lt;hero-name&gt;</b></font></tt>, к ней применяются настройки фразы героя.</p>
		<p><tt><font color="008800"><b>dynamic-code:</b></font>[$текст]<font color="008800"><b>:dynamic-code</b></font></tt> — между этими тегами помещается обычный код QSP, который будет выполнен во время интерпретации реплики.</p>
		<p><tt><font color="008800"><b>levelup:</b></font>[#число]</tt> — команда в виде одиночного тега, которая "возвращает" интерпретатор на несколько уровней вверх по узлам.</p>
		<p><tt><font color="008800"><b>leveljump:</b></font>[$метка]</tt> — команда в виде одиночного тега, которая отправляет интерпретатор к реплике, содержащей указанную метку. Метка указывается в значении тега.</p>
		<p><tt><font color="008800"><b>marker:</b></font>[$метка]</tt> — одиночный тег, значение которого считается меткой реплики.</p>
		<p><tt><font color="0000ff"><b>closeup</b></font></tt> — команда, наличие которой в интерпретируемой реплике приведёт к закрытию диалога.</p>
		<p><tt><font color="0000ff"><b>selectact.delete</b></font></tt> — команда, наличие которой в интерпретируемой реплике приведёт к удалению текущего действия из списка без обновления списка.</p>
		<p><tt><font color="666666"><b>&lt;!--</b></font>[$комментарий]<font color="666666"><b>--&gt;</b></font></tt> — открывающий и закрывающий теги комментария. В комментарии можно помещать всё, кроме фраз актёров и героя и других комментариев. Комментарии можно размещать в любом месте диалога, но не между тегами <tt>dynamic-code: :dynamic-code</tt> и <tt>iffing: :iffing</tt>. При наличии внутри комментариев описанных выше тегов и комманд, следует отделять их от тегов комментария хотя бы одним пробелом. Текст комментариев не выводится на экран.</p>
		<h4>Планируемые решения</h4>
		<font size="-1">Нижеследующие команды и конструкции возможно будут введены в версии модуля 2.0. Названия и принцип действия могут отличаться от приведённых ниже.</font>
		<p><tt><font color="880000"><b>bwaiting:</b></font>[#миллисекунды]</tt> — настройка задержки вывода на экран фраз из блока фраз. В настоящий момент задержка существует, но не настраивается из-под диалога. Предшествует каждой отдельной фразе в т.ч. и без указания тегов <tt><font color="660066"><b>&lt;npc-name&gt;</b></font></tt> и <tt><font color="660066"><b>&lt;hero-name&gt;</b></font></tt>.</p>
		<p><tt><font color="880000"><b>bwaiting:</b></font>[#миллисекунды]</tt> — настройка задержки вывода на экран текста реплики.</p>
		<p><tt><font color="880000"><b>selectreplic.delete</b></font></tt> — команда удаления реплики из диалога. Реплика удаляется из текущего диалога. Если закрыть и вновь открыть диалог, реплика вновь появится в ветке.</p>
		<p><tt><font color="880000"><b>selectreplic.kill</b></font></tt> — команда удаления реплики из диалога. Реплика удаляется из диалога насовсем. То есть если закрыть диалог, а потом вновь открыть, реплика не появится в ветке.</p>
		<p><tt><font color="880000"><b>act-close="</b></font>[$настройки]<font color="880000"><b>"</b></font></tt> — конструкция, в которую помещаются настройки стандартного действия закрытия диалога. Стандартное действие - это действие, которое будет появляться в списке действий постоянно.</p>
		<p><tt><font color="880000"><b>act-up="</b></font>[$настройки]<font color="880000"><b>"</b></font></tt> — конструкция, в которую помещаются настройки стандартного действия, возвращающего на несколько узлов вверх. В частности такое действие должно возвращать к последнему узлу, где обновлялся список действий.</p>
		<p>Возможно будет введена конструкция описания стандартных действий/реплик героя, которые должны повторяться на протяжении всей ветки диалога. <tt><font color="880000"><b>act-standart="</b></font>[$настройки]<font color="880000"><b>"</b></font></tt> - вместо настроек перечисляются метки стандартных реплик. Сами реплики располагаются в скрытой ветке.</p>

	<a name="zna4enia-po-umol4aniu"></a><h3>Конструирование диалога</h3>
		<a name="replics-construct"></a><h4>Конструирование реплик</h4>

		<p>Каждая реплика, за исключением корневой, должна быть помещена в теги реплики:</p>
		<p><div style="margin-left:0.5cm"><ul><li><tt><font color="008800"><b>{:</b></font>[$текст]<font color="008800"><b>:}</b></font></tt> - для реплик актёра.</li><li><tt><font color="008800"><b>[:</b></font>[$текст]<font color="008800"><b>:]</b></font></tt> - для реплик героя.</li></ul></div></p>
		<P>Реплики могут включать в себя следующие элементы:</P>
		<div style="margin-left:0.5cm"><ul style="circle">
			<li>текст реплики
			<li>конструкции настроек (<tt><font color="008800"><b>npc="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>, <tt><font color="008800"><b>hero="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>, <tt><font color="008800"><b>replics="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>)
			<li>конструкцию условия вывода реплики (<tt><font color="008800"><b>iffing:</b></font>[$условия]<font color="008800"><b>:iffing</b></font></tt>)
			<li>конструкцию динамического кода, выполняемого при интерпретации реплики (<tt><font color="008800"><b>dynamic-code:</b></font>[$текст]<font color="008800"><b>:dynamic-code</b></font></tt>)
			<li>конструкцию блока фраз (<tt><font color="008800"><b>frase-block:</b></font>[$текст]<font color="008800"><b>:frase-block</b></font></tt>)
			<li>конструкцию для замены имени действия (<tt><font color="008800"><b>act-name:</b></font>[$текст]<font color="008800"><b>:act-name</b></font></tt>)
			<li>команды <tt><font color="008800"><b>levelup:</b></font>[#число]</tt>, <tt><font color="008800"><b>leveljump:</b></font>[$метка]</tt>, <tt><font color="0000ff"><b>closeup</b></font></tt>, <tt><font color="0000ff"><b>selectact.delete</b></font></tt>
			<li>тег метки <tt><font color="008800"><b>marker:</b></font>[$метка]</tt>
			<li>комментарий - один или несколько
		</ul></div>
		<p>При этом, всё, кроме текста реплики и комментариев, можно помещать внутри комментариев. Можно и не помещать.</P>
		<p>Вышеперечисленные элементы могут отсутствовать в реплике. Если в реплике нет ни одного из вышеперечисленных элементов, механизмы модуля всё равно будут воспринимать её, как обычную реплику, т.е. пытаться интерпретировать.</p>
		<p>Реплики могут включать другие реплики, помещённые в теги реплик. На этом построен механизм интерпретации последовательности вложенных реплик.</p>

		<a name="comments"></a><h4>Комментирование</h4>
		<P>Для того, чтобы писать комментарии в теле диалога и в его заголовке, была введена конструкция комментариев из html. Комментарии представляют собой запись между открывающим тегом "<tt><font color="666666"><b>&lt;!--</b></font></tt>" и закрывающим "<tt><font color="666666"><b>--&gt;</b></font></tt>". Эти теги так и называются: теги комментария. Название "тег комментария", если не уточняется открывающий или закрывающий, означает тоже самое.</P>
		<p>Комментарии могут быть как однострочными, так и многострочными.</p>
		<p>Отделять содержимое комментария от его тегов следует хотя бы одним пробельным символом или переводом строки.</p>
		<p>Нельзя размещать комментарии внтури комментариев. Запись<br><br><tt><font color="666666"><b>&lt;!-- текст комментария </b>&lt;!-- текст вложенного комментария --&gt;<b> текст комментария --&gt;</b></font></tt><br><br>недопустима.</p>
		<p>Недопустимо также использовать комментарии между тегами <tt><font color="008800"><b>dynamic-code:&nbsp;:dynamic-code</b></font></tt> и <tt><font color="008800"><b>iffing:&nbsp;:iffing</b></font></tt>, поскольку между ними помещается чистый код QSP.</p>
		<p>В тегах <tt><font color="008800"><b>act-name:&nbsp;:act-name</b></font></tt>, в конструкциях блоков фраз, а также в самих фразах комментарии допустимы, поскольку игнорируются html-рендерером QSP-плеера как нормальные html-комментарии.</p>
		<p>Все команды и конструкции реплики, кроме фразы, допустимо и желательно помещать в комментарии. Лучше всего - в один. В таких комментариях будет игнорироваться весь текст, помимо текста самих конструкций и настроек.</p>
		<p>Внутри конструкций настроек (<tt><font color="008800"><b>npc="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>, <tt><font color="008800"><b>hero="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>, <tt><font color="008800"><b>replics="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt>) допустимо произвольное комментирование без использования тегов комментария. Весь текст, помимо тегов настроек и их значений, будет проигнорирован механизмом извлечения настроек. Необходимо лишь отделять значение тегов от произвольного текста хотя бы одним пробелом, символом перевода строки или табуляции.</p>
		<p>Если вы включаете в комментарий команду или одиночный тег, озаботьтесь отделить команду, одиночный тег или его значение от тегов комментария хотя бы одним пробелом (табуляцией или переводом строки).</p>

		<a name="settings"></a><h4>Конструирование настроек</h4>
		<p>В настоящей версии модуля для настроек предусмотрены три конструкции. Конструкции <tt><font color="008800"><b>npc="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> и <tt><font color="008800"><b>hero="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> сходны по своему содержанию и используют одинаковые команды и теги. Конструкция <tt><font color="008800"><b>replics="</b></font>[$настройки]<font color="008800"><b>"</b></font></tt> предполагает другой набор команд и тегов. Однако правила записи всех треёх конструкций одинаковы.</p>
		<P>Вместо двойного аппострофа для записи конструкций можно использовать одиночный апостроф:</P>
		<p><tt><font color="008800"><b>npc='</b></font>[$настройки]<font color="008800"><b>'</b></font></tt><br>
		<tt><font color="008800"><b>hero='</b></font>[$настройки]<font color="008800"><b>'</b></font></tt><br>
		<tt><font color="008800"><b>replics='</b></font>[$настройки]<font color="008800"><b>'</b></font></tt></p>
		<p>Между апострофами можно размещать любой текст и количество строк. Весь текст, кроме команд, тегов и их содержимого, будет игнорироваться при извлечении настроек.</p>
		<P>Каждую команду, тег и его содержимое нужно отделять от прочего текста хотя бы одним пробелом или переводом строки.</P>
		<p>Теги и команды можно располагать в произвольном порядке, это никак не скажется на чтении их содержимого.</p>
		<p>Если в тексте настроек два и более раз написан один и тот же тег, используется значение тега, расположенного ближе к началу текста настроек.</p>
		<p>Если в тексте настроек не указан какой-либо из тегов, его значением будет считаться значение, полученное от родительской реплики или дефолтное значение. Если это заголовок диалога, значением тега будет принято значение по умолчанию.</p>
		<p>Теги настроек и их значения желательно помещать в круглые скобки. Можно в квадратные, угловые и фигурные, но предпочтительней круглые.</p>

		<a name="dialogs"></a><h4>Теги и их значения</h4>
		<p>Значением сдвоенного тега считается весь текст с самого первого символа сразу после открывающего тега, до последнего символа включительно перед закрывающим тегом. В зависимости от назначения тега, пробельные символы и переводы строки в начале значения, будут игнорироваться или напротив - включаться в значение.</p>
		<p>Игнорируются все переводы строк и пробельные символы непосредственно после открывающего тега и непосредственно перед закрывающим для:
		<ul>
		<li>тегов реплик <tt><font color="008800"><b>{: :}</b></font></tt> и <tt><font color="008800"><b>[: :]</b></font></tt></li>
		<li>тегов <tt><font color="008800"><b>iffing:&nbsp;:iffing</b></font></tt></li>
		<li>тегов <tt><font color="008800"><b>dynamic-code:&nbsp;:dynamic-code</b></font></tt></li>
		<li>тегов <tt><font color="008800"><b>frase-block:&nbsp;:frase-block</b></font></tt></li>
		</ul></p>
		<p>Все переводы строк и пробельные символы сохраняются при получении и обработке значений для:</p>
		<ul>
			<li>тегов <tt><font color="008888"><b>name:&nbsp;:name</b></font></tt></li>
			<li>тегов <tt><font color="008800"><b>act-name:&nbsp;:act-name</b></font></tt></li>
			<li>тегов <tt><font color="666666"><b>&lt;!--&nbsp;--&gt;</b></font></tt></li>
		</ul>
		<p>Это связано всего лишь с методами распознавания содержимого.</p>
		<p>Таким образом в качестве значения сдвоенного тега может использоваться абсолютно любой набор символов. Можно включать в значение тега (в зависимости от нужд) переводы строк, пробелы и символы табуляции.</p>
		<P>Ни в коем случае нельзя включать одинаковые сдвоенные теги друг в друга. Запись типа</P>
		<p><tt><pre><b><font color="008800">
	frase-block:
		Фраза
		<font color="880000">frase-block:
			фраза фраза фраза
		:frase-block</font>
		Ещё одна фраза
	:frase-block
		</font></b></pre></tt></p>
		<p>недопустима.</P>
		<p>Значением одиночного тега считается весь текст, начиная с первого символа непосредственно сразу после тега и заканчивая включительно символом, стоящим перед первым встреченным пробельным символом или переводом строки.</p> <p>Таким образом в одиночные теги можно помещать только непробельные символы.</p>
		<p>Однако, если одиночный тег и его содержимое заключены в скобки, причём между открывающей скобкой и тегом нет пробелов и переводов строки, в значении тега можно использовать и пробелы и переводы строки.</p>
		<p>Если же одиночный тег и его значение записываются без скобок, они должны отделяться от остального текста хотя бы одним пробелом или переводом строки.</p>
		<p>Если одиночный тег помещается в сдвоенный тег и не заключается в скобки, он должен отделяться от тегов сдвоенного тега хотя бы одним пробелом. Запись типа</p>
		<p><tt><pre><b><font color="666666">
	&lt;!-<font color="ff0000">-n</font>color:88888<font color="ff0000">8-</font>-&gt;
		</font></b></pre></tt></p>
		<p>недопустима.</p>
		<p>Можно использовать запись</p>
		<p><tt><pre><b><font color="666666">
	&lt;!--&nbsp;ncolor:888888&nbsp;--&gt;
		</font></b></pre></tt></p>
		<p>или</p>
		<p><tt><pre><b><font color="666666">
	&lt;!--(nolor:888888)--&gt;
		</font></b></pre></tt></p>
		<a name="dialogs"></a><h4>Составление диалогов</h4>
		<p>Диалоги составляются из реплик актёров и/или героя. </p><p>Для чередования реплик - одни реплики вкладываются в другие. Сначала интерпретируется родительская реплика, а потом - все реплики-ответвления, являющиеся её дочерними репликами. При этом реплики актёра интерпретируются полностью, и фразы выводятся автоматически, а реплики героя интерпретируются частично и выводятся в виде действий. Когда игрок выбирает действие, реплика, на которой основано это действие, интерпретируется полностью.</p><p> Реплики, которые не содержат фразы, не выводятся на экран, однако их содержимое интерпретируется, как и содержимое реплик, которые содержат фразы.</p>
		<p>Список действий при интерпретации реплики обновляется только в том случае, если реплики героя вложены в одну актёрскую реплику.</p><p>Если интерпретируется реплика героя, в которую вложена реплика героя, то последняя выводится в виде действия, добавляемого в список без обновления списка действий. Пример:</p>
		<p><tt><pre><b><font color="006600">
	[:
		А если я захочу выбрать вариант вопроса, который исчез?
		<font color="999933">&lt;!-- действие которое должно удаляться после выбора selectact.delete --&gt;</font>
		{:
			Весь наш разговор происходит в цикле, как только мы закончим обсуждать текущий вопрос,
			мы вернёмся к общему списку вопросов. Если хочешь, ты можешь сделать это прямо сейчас.
		:}
		[:
			<font color="999933">&lt;!-- действие, которое должно появиться без очистки списка действий --&gt;</font>
			То есть, я могу спросить что-то другое?
			{:
				Да, конечно, спрашивай, что хочешь.
				<font color="999933">&lt;!-- leveljump:other_question --&gt;</font>
			:}
		:]
	:]
		</font></b></pre></tt></p>
		<p>Как отмечено выше, если не указана фраза реплики, реплика интерпретируется, но на экран ничего не выводится. Эта особенность позволяет создавать скрытые ветки. Для этого ветка размещается в пустой реплике героя. Пустые реплики героя не выводятся в виде действий.</p>
		<p>Чтобы пустая реплика героя всё же выводилась на экран в виде действия, название действия следует поместить между тегами <tt><font color="008800"><b>act-name:&nbsp;:act-name</b></font></tt>.</p>
		<p>Все фразы выводятся на экран с сохранением перевода строк. Следует учитывать это при организации диалога.</p>

	<a name="zna4enia-po-umol4aniu"></a><h3>Значения по умолчанию</h3>

		<p>Значения по умолчанию - это различные значения переменных настроек оформления и прочего, принимаемые тогда, когда явно заданные значения отсутствуют или ошибочны. Значения по умолчанию вшиты в механизм получения настроек.</p><p>Ниже перечислены настройки и значения по умолчанию.</p>
		<p><font color="440088">Имя</font><br>Указывается между тегами <tt><b><font color="006666">name:&nbsp;:name</font></b></tt><br>по умолчанию, и для актёра и для героя: пустое значение, отсутствует, <tt><b><font color="006666">name::name</font></b></tt>.</p>
		<p><font color="440088">Цвет имени</font><br>Указывается после тега <tt><b><font color="006666">ncolor:</font></b></tt><br>по умолчанию, для актёра: чёрный, <tt><b><font color="006666">ncolor:</font>000000</b></tt><br>по умолчанию, для героя: серый, <tt><b><font color="006666">ncolor:</font>888888</b></tt>.</p>
		<p><font color="440088">Аттрибуты имени</font><br>Указывается после тега <tt><b><font color="006666">nattrib:</font></b></tt><br>по умолчанию, для актёра: жирный, <tt><b><font color="006666">nattrib:</font>-b</b></tt><br>по умолчанию, для героя: жирный курсив, <tt><b><font color="006666">nattrib:</font>-b-i</b></tt>.</p>
		<p><font color="440088">Цвет фразы</font><br>Указывается после тега <tt><b><font color="006666">fcolor:</font></b></tt><br>по умолчанию, для актёра: чёрный, <tt><b><font color="006666">fcolor:</font>000000</b></tt><br>по умолчанию, для героя: серый, <tt><b><font color="006666">fcolor:</font>888888</b></tt>.</p>
		<p><font color="440088">Аттрибуты фразы</font><br>Указывается после тега <tt><b><font color="006666">fattrib:</font></b></tt><br>по умолчанию, для актёра: нормальный, <tt><b><font color="006666">fattrib:</font></b></tt><br>по умолчанию, для героя: курсив, <tt><b><font color="006666">fattrib:</font>-i</b></tt>.</p>
		<p><font color="440088">Знак мыслеотделительный. Знак перед прямой речью</font><br>Указывается после тега <tt><b><font color="006666">tire:</font></b></tt><br>по умолчанию, для актёра и героя: тире отбитое пробелами, <tt><b><font color="006666">tire:</font> — </b></tt>.</p>
		<p><font color="440088">Режим повтора ответвлений</font><br>Указывается после тега <tt><b><font color="006666">repeat:</font></b></tt><br>по умолчанию (только для актёрских реплик): по-кругу, непрерывное, <tt><b><font color="006666">repeat:</font>cicle</b></tt>.</p>
		<p><font color="440088">Режим выбора следующего ответвления</font><br>Указывается после тега <tt><b><font color="006666">shuffle:</font></b></tt><br>по умолчанию (только для актёрских реплик): случайным образом, <tt><b><font color="006666">shuffle:</font>random</b></tt>.</p>

	<a name="zna4enia-po-umol4aniu"></a><h3>Подключение и использование</h3>

		<p>Файл модуля <tt><font color="000099">easy.dialog.qsp</font></tt> поставляется вместе с файлом библиотеки <tt><font color="000099">easy.math.qsp</font></tt> и работает только при наличии оного. Для использования модуля и библиотеки, оба файла подключаются к основному файлу игры:</p>
		<p><tt><pre><b>
	addqst 'lib/easy.math.qsp'
	addqst 'lib/easy.dialog.qsp'
		</b></pre></tt></p><p>(в архиве оба файла помещены в папку "<tt>lib</tt>". При подключении к игре вместо "<tt>lib/</tt>" следует использовать настоящий относительный путь до файлов модуля и библиотеки.)</p>
		<p>Желательно включение режима распознавания html-тегов (<tt><b><font color="ff0000">usehtml</font> = <font color="880088">1</font></b></tt>).</p>
		<p>Диалоги для модуля пишутся в виде текстовых констант, или значений текстовых переменных. После чего константа или значение переменной передаются в качестве нулевого аргумента локации <tt><font color="006600">dialog.int</font></tt>. Вызывать локацию следует через команду <tt><font color="0000ff">gosub</font></tt>:</p>
		<p><tt><pre><b>
	<font color="0000ff">gosub</font> <font color="006600">'dialog.int'</font>, <font color="880088">$переменная_диалог</font>
	<font color="0000ff">gosub</font> <font color="006600">'dialog.int'</font>, <font color="009900">'
		{:Короткий диалог
			[:Короткое действие:]
		:}'</font>
		</b></pre></tt></p>
		<p>При вызове <tt>dialog.int</tt> будет очищено основное описание, список действий и дополнительное описание. После того как диалог будет закрыт, и описания и список действий восстановятся.</p>
		<p>При интерпретации реплики игнорируется преформатирование (символы пробелов и табуляций перед строками; строки не содержащие непробельных символов до первыой строки, содержащей непробельные символы, и после последней строки, содержащей непробельные символы).</p>
		</td></tr></table>
		<br><br><br><table width=100%><tr><td width=50%>&nbsp;</td><td><font size=1>Aleks Versus'easy.libraries'2014<br>Aleks Versus'GAM'RUS'2014</font></td></tr></table><br><br>
	</body>
</html>
