<!DOCTYPE html>
<html lang="ru">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
  <!-- TODO: favicon -->
  <link href="../../res/css/easy.library.css" rel="stylesheet"/>
 </head>
 <body>
  <div class="avs-page-wrapper">
   <div class="easy-lib-page">
    <article class="e-block">
     <style>
      .temp-biruz {
          color: #15c3c3;
        }

        .temp-red {
          color: #ff6b6b;
        }

        .temp-violet {
          color: #c7a0f4;
        }

        .temp-orange {
          color: #ff8800
        }
     </style>
     <div class="avs-pages-button__wrapper">
      <div class="avs-pages-button__left-combine">
       <a class="avs-pages-button__link" href="../../easy.dialog/manual.html">
        <div class="avs-pages-button">
         Назад
        </div>
       </a>
       <a class="avs-pages-button__link" href="../../easy.dialog/manual/0-40.html">
        <div class="avs-pages-button">
         ⇦ Настройки диалога
        </div>
       </a>
      </div>
      <a class="avs-pages-button__link" href="../../easy.dialog/manual/0-42.html">
       <div class="avs-pages-button">
        Ещё чуть более сложные диалоги ⇨
       </div>
      </a>
     </div>
     <h1 class="avs-article-h1">
      easy.dialog
     </h1>
     <p class="avs-articles-underhead">
      Подробное руководство по использованию модуля, с примерами. Страница третья
     </p>
     <a id="hardly_easy_dialog" name="hardly_easy_dialog">
     </a>
     <h2 class="avs-article-h2">
      Чуть более сложные диалоги
     </h2>
     <a id="root_stick" name="root_stick">
     </a>
     <h3 class="avs-article-h3">
      Корни, ветви и узлы
     </h3>
     <p class="avs-article-p">
      Для продолжения нам нужно разобраться в структуре диалогов и договориться о терминологии.
     </p>
     <p class="avs-article-p">
      Из предыдущего раздела мы узнали, как пишутся диалоги. Реплики персонажа помещаются между тегами "{:" и ":}", а реплики героя между "[:" и ":]". При этом реплики персонажа должны выводиться на экран автоматически, а реплики героя сначала представать в виде действий. Чтобы соотнести одни реплики с другими, мы научились "вкладывать" одни реплики в другие. Выбор одной из реплик приводит к выводу вложенных реплик, те в свою очередь тянут за собой ещё вложенные реплики и т.д.
     </p>
     <p class="avs-article-p">
      Но с чего же модуль начинает? Должна же быть какая-то реплика, с которой начинается вывод всех остальных реплик. Да. Такая реплика есть, хотя до сих пор мы не называли её репликой и не использовали как реплику. Это реплика, которая не включается в теги и собственно вынесена из диалога. В ней прописываются все дефолтные настройки. Она называется корнем диалога, корневой репликой или заголовком диалога. Модуль не применяет к ней никаких настроек форматирования и все прописанные в ней фразы выводятся как есть, без имени персонажа или героя перед ними. Возьмём предпоследний пример и слегка его изменим, чтобы взглянуть на то, как выглядит корень диалога (подсвечен фиолетовым цветом):
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        <span class="temp-violet">npc="<br/>
        name:Ведущий:name<br/>
        ncolor:008888<br/>
        fcolor:008888<br/>
        "<br/>
        hero="<br/>
        name:Вася Пупкин:name<br/>
        "<br/>
        Это заголовок диалога. Его корень. Данные реплики будут выведены<br/>
        на экран как есть, без применения форматирования из настроек диалога.<br/>
        Тем не менее символы пробелов и табуляций перед строками, а так же<br/>
        лишние переводы строк будут удалены.</span><br/>
        {:<br/>
           Как вас зовут?<br/>
           [:<br/>
        <br/>
           hero="ncolor:008800"<br/>
              Меня зовут Вася.<br/>
              {:Вас зовут Вася?<br/>
                 [:<br/>
                 npc="fcolor:880000"<br/>
                 Да, меня зовут Вася.<br/>
                    {:да ну нафиг:}<br/>
                    [:<br/>
                    нет. чистая правда<br/>
                    :]<br/>
                 :]<br/>
                 [:Нет, никто меня так не зовёт:]<br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Васей?<br/>
                 [:Правда<br/>
                 :]<br/>
                 [:Неправда:]<br/>
              :}<br/>
           :]<br/>
           [:<br/>
           hero="ncolor:ff0000"<br/>
              Меня зовут Петя.<br/>
              {:<br/>
                 Вас зовут Петя?<br/>
                 [:Да{:Как это удобно!:}:]<br/>
                 [:<br/>
                    Нет<br/>
                    {:Вас зовут не Петя? Как неудобно!:}<br/>
                 :]<br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Петей?<br/>
                 [:Правда:]<br/>
                 [:Неправда:]<br/>
              :}<br/>
              {:Неужели в самом деле Петей Вас зовут?<br/>
                 [:В самом деле:]<br/>
                 [:Нет, не в самом:]<br/>
              :}<br/>
           :]<br/>
        :}</span></pre>
     <p class="avs-article-p">
      Итак, корень - это реплика, которая помещена вне остального диалога, вне тегов, но меж тем в неё "помещены" все остальные реплики. Корень - это реплика, с которой начинается вывод диалога на экран. Естественно, если текст реплики отсутствует, на экран ничего не выводится, даже пустые строки.
     </p>
     <p class="avs-article-p">
      Когда модуль находит первую реплику диалога (его корень) и выводит её на экран (или не выводит, если фраза не прописана), он находит также и все вложенные реплики. В нашем примере он отыщет всего одну реплику "Как вас зовут?". Для наглядности я выделил её красным:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        <span class="temp-violet">npc="<br/>
        name:Ведущий:name<br/>
        ncolor:008888<br/>
        fcolor:008888<br/>
        "<br/>
        hero="<br/>
        name:Вася Пупкин:name<br/>
        "<br/>
        Это заголовок диалога. Его корень. Данные реплики будут выведены<br/>
        на экран как есть, без применения форматирования из настроек диалога.<br/>
        Тем не менее символы пробелов и табуляций перед строками, а так же<br/>
        лишние переводы строк будут удалены.</span><br/>
        <span class="temp-red">{:<br/>
           Как вас зовут?</span><br/>
           [:<br/>
        <br/>
           hero="ncolor:008800"<br/>
              Меня зовут Вася.<br/>
              {:Вас зовут Вася?<br/>
                 [:<br/>
                 npc="fcolor:880000"<br/>
                 Да, меня зовут Вася.<br/>
                    {:да ну нафиг:}<br/>
                    [:<br/>
                    нет. чистая правда<br/>
                    :]<br/>
                 :]<br/>
                 [:Нет, никто меня так не зовёт:]<br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Васей?<br/>
                 [:Правда<br/>
                 :]<br/>
                 [:Неправда:]<br/>
              :}<br/>
           :]<br/>
           [:<br/>
           hero="ncolor:ff0000"<br/>
              Меня зовут Петя.<br/>
              {:<br/>
                 Вас зовут Петя?<br/>
                 [:Да{:Как это удобно!:}:]<br/>
                 [:<br/>
                    Нет<br/>
                    {:Вас зовут не Петя? Как неудобно!:}<br/>
                 :]<br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Петей?<br/>
                 [:Правда:]<br/>
                 [:Неправда:]<br/>
              :}<br/>
              {:Неужели в самом деле Петей Вас зовут?<br/>
                 [:В самом деле:]<br/>
                 [:Нет, не в самом:]<br/>
              :}<br/>
           :]<br/>
        <span class="temp-red">:}</span>
        </span></pre>
     <p class="avs-article-p">
      Распознав тип этой реплики, модуль поймёт, что она должна быть выведена автоматически и повторит ту же процедуру, что проделал с корневой репликой, но на этот раз применит к ней настройки. Т.е. выведет фразу как реплику неписи. Затем он вновь проверит, нет ли в этой реплике вложенных и обнаружит целых две. Каждую из них я выделил отдельным цветом:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        <span class="temp-violet">npc="<br/>
        name:Ведущий:name<br/>
        ncolor:008888<br/>
        fcolor:008888<br/>
        "<br/>
        hero="<br/>
        name:Вася Пупкин:name<br/>
        "<br/>
        Это заголовок диалога. Его корень. Данные реплики будут выведены<br/>
        на экран как есть, без применения форматирования из настроек диалога.<br/>
        Тем не менее символы пробелов и табуляций перед строками, а так же<br/>
        лишние переводы строк будут удалены.</span><br/>
        <span class="temp-red">{:<br/>
           Как вас зовут?</span><br/>
           <span class="temp-biruz">[:hero="ncolor:008800"<br/>
              Меня зовут Вася.</span><br/>
              {:Вас зовут Вася?<br/>
                 [:<br/>
                 npc="fcolor:880000"<br/>
                 Да, меня зовут Вася.<br/>
                    <span class="Monokai-Initial">{:да ну нафиг:}<br/>
                    [:нет. чистая правда:]</span><br/>
                 :]<br/>
                 <span class="Monokai-Initial">[:Нет, никто меня так не зовёт:]</span><br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Васей?<br/>
                 <span class="Monokai-Initial">[:Правда:]<br/>
                 [:Неправда:]</span><br/>
              :}<br/>
           <span class="temp-biruz">:]</span><br/>
           <span class="temp-orange">[:hero="ncolor:ff0000"<br/>
              Меня зовут Петя.</span><br/>
              {:<br/>
                 Вас зовут Петя?<br/>
                 [:Да<span class="Monokai-Initial">{:Как это удобно!:}</span>:]<br/>
                 [:Нет<br/>
                    <span class="Monokai-Initial">{:Вас зовут не Петя? Как неудобно!:}</span><br/>
                 :]<br/>
              :}<br/>
              {:<br/>
                 Это правда, что вас зовут Петей?<br/>
                 <span class="Monokai-Initial">[:Правда:]</span><br/>
                 <span class="Monokai-Initial">[:Неправда:]</span><br/>
              :}<br/>
              {:Неужели в самом деле Петей Вас зовут?<br/>
                 <span class="Monokai-Initial">[:В самом деле:]</span><br/>
                 <span class="Monokai-Initial">[:Нет, не в самом:]</span><br/>
              :}<br/>
           <span class="temp-orange">:]</span><br/>
        <span class="temp-red">:}</span>
        </span></pre>
     <p class="avs-article-p">
      Каждая из этих реплик появится в виде действия. Искать вложенные в них реплики не имеет смысла, пока игрок не выберет одно из действий, поэтому модуль пока остановится.
     </p>
     <p class="avs-article-p">
      Мы тоже остановимся, но совсем по другой причине. На этом примере мы увидели сразу два элемента диалога: узел и ветви. Узлом считается любая реплика, в которую "вложены" другие реплики. Не обязательно две. Может быть и одна, и три, и сто тысяч миллионов. Узлы различаются по типам точно так же, как и реплики: узел с репликой персонажа (актёрский узел) и узел с репликой героя (геройский узел, узел действия). Реплика, в которую не "вложено" ни одной другой реплики, называется финальной (последней, конечной. В нашем примере финальные реплики выделены чёрным цветом.). Две однотипные реплики, вложенные в одну реплику, считаются (и называются) ветвями диалога. Такие реплики называются одноуровневыми, то есть находящимися на одном уровне. Уровень реплики считается по количеству узлов, которые ей предшествовали. Поскольку корневой реплике не предшествует ни одного узла, она считается нулевым уровнем. Реплика "Как вас зовут?" из примера - первый уровень, и т.д.
     </p>
     <a id="head-hide-replics" name="head-hide-replics">
     </a>
     <h3 class="avs-article-h3">
      Скрытый узел
     </h3>
     <p class="avs-article-p">
      Иногда нужно скрыть узел или целую ветку, чтобы она не выводилась ни при каких условиях, пока не будет осуществлён
      <a class="avs-page-external-link" href="#prinuditelny_perehod" style="text-decoration:none" title="заголовок: Принудительные переходы и закрытие диалога">
       принудительный переход
      </a>
      . Чтобы сделать это нужно завести пустой узел действия. Особенность работы модуля состоит в том, что он не выводит действия с пустым именем, поэтому в пустых узлах действий можно прятать другие реплики и целые ветви. Пример:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        [:<br/>
           {: Скрытая реплика :}<br/>
           {: Ещё одна скрытая реплика :}<br/>
           {: А это целая скрытая ветка<br/>
              [:<br/>
                 Да, а вот и ответвление<br/>
                 {:И финальная реплика:}<br/>
              :]<br/>
              [:<br/>
                 Да, а вот и другое ответвление<br/>
                 {:И ещё одна финальная:}<br/>
              :]<br/>
           :}<br/>
        :]</span></pre>
     <a id="remarks" name="remarks">
     </a>
     <h3 class="avs-article-h3">
      Ремарки
     </h3>
     <p class="avs-article-p">
      Ремарка - это авторский текст, который бывает нужно поместить между репликами. Специальных настроек для ремарок нет, но делать их, тем не менее, просто. Для этого в текущую реплику неписи или героя можно добавить реплику с настройками, отменяющими имя актёра и тире (код ремарки выделен голубым цветом):
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        {:<br/>
           npc="name:Ведущий:name"<br/>
           Как вас зовут?<br/>
           <span class="temp-biruz">{:   <br/>
              npc="name::name<br/>
              tire:nope"<br/>
              &lt;i&gt;<br/>
              Что Вы на это ответите?<br/>
              &lt;/i&gt;<br/>
           :}</span><br/>
        :}</span></pre>
     <p class="avs-article-p">
      Ремарки желательно делать финальными репликами, хотя и не обязательно.
     </p>
     <a id="remark_inside" name="remark_inside">
     </a>
     <h4 class="avs-article-h4">
      Ремарки внутри реплики
     </h4>
     <p class="avs-article-p">
      Ремарки внутри реплики - это некоторые авторские пояснения, которые нужно вывести непосредственно внутри реплики. Например, прервать речь актёра, чтобы пояснить, какое действие он выполняет, пока произносит фразу. Или указать с какой интонацией или силой произносится фраза. Вот примеры таких ремарок:
     </p>
     <div class="em-on-screen">
      <font color="008888">
       <b>
        Мишель
       </b>
       <i>
        <font color="888888">
         (громко)
        </font>
       </i>
       <b>
        :
       </b>
      </font>
      <font color="000000">
       — Яичница с ветчиной, это сколько?
      </font>
      <br/>
      <br/>
      <font color="008800">
       <b>
        Мыса:
       </b>
      </font>
      <font color="000000">
       — На весну оставляю,
       <i>
        <font color="888888">
         — хныча, малец потёр багровое ухо. —
        </font>
       </i>
       Голодно будет.
      </font>
     </div>
     <p class="avs-article-p">
      В первом случае ремарка идёт сразу после имени и её отличие от имени в том, что она написана нежирным шрифтом, курсивом и серым цветом. Во втором случае ремарка прерывает прямую речь, и в отличие от прямой речи она написана курсивом и другим цветом. Последнюю сделать проще всего. Мы просто вставляем в фразу html-теги, которые изменят цвет и наклон текста:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        {:<br/>
           npc="name:Мыса:name ncolor:008800 fcolor:000000 nattrib:-b-n fattrib:-n"<br/>
           На весну оставляю, &lt;i&gt;&lt;font color="888888"&gt;— хныча, малец потёр багровое ухо. —&lt;/font&gt;&lt;/i&gt; Голодно будет.<br/>
        :}
        </span></pre>
     <p class="avs-article-p">
      Чтобы сделать ремарку для первого случая, можно прибегнуть к одной из хитростей. Например, можно задать персонажу пустое имя и полностью прописать строку реплики со всеми именами, тегами и пр.:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        {:<br/>
           npc="name:Мишель:name ncolor:008800 fcolor:000000 nattrib:-b-n fattrib:-n"<br/>
           {:npc="name::name"<br/>
           &lt;font color="008888"&gt;&lt;b&gt;Мишель &lt;/b&gt;&lt;i&gt;&lt;font color="888888"&gt;(громко)&lt;/font&gt;&lt;/i&gt;&lt;b&gt;:&lt;/b&gt;&lt;/font&gt;<br/>
           &lt;font color="000000"&gt; — Яичница с ветчиной, это сколько?&lt;/font&gt;<br/>
           :}<br/>
        :}
        </span></pre>
     <p class="avs-article-p">
      Или изменить имя персонажа на имя, в которое уже будет включена ремарка:
     </p>
     <pre class="Monokai-Code"><span class="Monokai-String">
        {:<br/>
           npc="name:Мишель:name ncolor:008800 fcolor:000000 nattrib:-b-n fattrib:-n"<br/>
           {:npc="name:Мишель &lt;/b&gt;&lt;i&gt;&lt;font color="888888"&gt;(громко)&lt;/font&gt;&lt;/i&gt;&lt;b&gt;:name"<br/>
           — Яичница с ветчиной, это сколько?<br/>
           :}<br/>
        :}
        </span></pre>
     <p class="avs-article-p">
      В последнем случае писанины меньше, однако нужно очень хорошо представлять себе, какие настройки применяются к имени.
     </p>
     <div class="avs-pages-button__wrapper">
      <div class="avs-pages-button__left-combine">
       <a class="avs-pages-button__link" href="../../easy.dialog/manual.html">
        <div class="avs-pages-button">
         Назад
        </div>
       </a>
       <a class="avs-pages-button__link" href="../../easy.dialog/manual/0-40.html">
        <div class="avs-pages-button">
         ⇦ Настройки диалога
        </div>
       </a>
      </div>
      <a class="avs-pages-button__link" href="../../easy.dialog/manual/0-42.html">
       <div class="avs-pages-button">
        Ещё чуть более сложные диалоги ⇨
       </div>
      </a>
     </div>
    </article>
    <aside class="e-block">
     <div class="avs-page-stamp">
      <p class="avs-empty">
       Aleks Versus'Easy Libraries'2013-
       <span class="subscribe-year">
        2023
       </span>
      </p>
      <p class="avs-empty">
       Aleks Versus'Game Adventure Making'Really Unimaginable Stories'2013-
       <span class="subscribe-year">
        2023
       </span>
      </p>
     </div>
    </aside>
   </div>
  </div>
 </body>
</html>